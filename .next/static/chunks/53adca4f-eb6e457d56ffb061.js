"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[510],{60814:function(e,t,n){n.d(t,{L9:function(){return t1},YH:function(){return X},_F:function(){return t3},iV:function(){return nT},q$:function(){return nr}});var r,i,l,o,a=n(85893),s=n(67294),c=n(82649),h=n(42076),u=n(62997),d=n.n(u),f=n(57122),p=n(96391),g=n(77493),y=n(50308),m=n.n(y),k=n(14176),v=n.n(k),b=n(52353),x=n.n(b),_=n(27361),w=n.n(_),E=n(85564),N=n.n(E),T=n(18446),M=n.n(T),L=n(42930),A=n(13218),C=n.n(A),S=n(47037),P=n.n(S),R=n(30998),D=n.n(R),B=n(57557),I=n.n(B),j=n(66678),O=n.n(j),Y=n(44908),W=n.n(Y),z=n(18156),J=n(76590),U=n(23493),V=n.n(U),F=n(23279),$=n.n(F),H=n(68458);function q(e){return h.V.compile({name:"blockTypeSchema",types:[e]}).get(e.name)}function Z(e){var t,n,r;if(!e)throw Error("Parameter 'portabletextType' missing (required)");let i=null==(t=e.of)?void 0:t.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!i)throw Error("Block type is not defined in this schema (required)");let l=null==(n=i.fields)?void 0:n.find(e=>"children"===e.name);if(!l)throw Error("Children field for block type found in schema (required)");let o=l.type.of;if(!o)throw Error("Valid types for block children not found in schema (required)");let a=o.find(e=>"span"===e.name);if(!a)throw Error("Span type not found in schema (required)");let s=o.filter(e=>"span"!==e.name)||[],c=(null==(r=e.of)?void 0:r.filter(e=>e.name!==i.name))||[];return{styles:function(e){var t,n,r;let i=null==(t=e.fields)?void 0:t.find(e=>"style"===e.name);if(!i)throw Error("A field with name 'style' is not defined in the block type (required).");let l=(null==(n=i.type.options)?void 0:n.list)&&(null==(r=i.type.options.list)?void 0:r.filter(e=>e.value));if(!l||0===l.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return l}(i),decorators:a.decorators,lists:function(e){var t,n;let r=null==(t=e.fields)?void 0:t.find(e=>"listItem"===e.name);if(!r)throw Error("A field with name 'listItem' is not defined in the block type (required).");let i=(null==(n=r.type.options)?void 0:n.list)&&r.type.options.list.filter(e=>e.value);if(!i)throw Error("The list field need at least to be an empty array");return i}(i),block:i,span:a,portableText:e,inlineObjects:s,blockObjects:c,annotations:a.annotations}}let K="sanity-pte:";function G(e){let t="".concat(K).concat(e);return d()&&d().enabled(t)?d()(t):d()(K)}d()(K);let X=()=>(0,f.E2)(12),Q=(0,s.createContext)(X),ee=()=>{let e=(0,s.useContext)(Q);if(void 0===e)throw Error("The `usePortableTextEditorKeyGenerator` hook must be used inside the <PortableTextEditor> component's context.");return e},et=new WeakMap,en=new WeakMap,er=new WeakMap,ei=new WeakMap,el=new WeakMap,eo=new WeakMap,ea=new WeakMap,es=new WeakMap,ec=new WeakMap;function eh(e){let t=e.charCodeAt(0);return t>=56320&&t<=57343}function eu(e){let[t,n]=e;return[t,n]}function ed(e,t){let n=e,r=t,i=n.length,l=r.length;if(0===i||0===l)return 0;i>l?n=n.substring(i-l):i<l&&(r=r.substring(0,i));let o=Math.min(i,l);if(n===r)return o;let a=0,s=1;for(let e=0;-1!==e;){let t=n.substring(o-s);if(-1===(e=r.indexOf(t)))break;s+=e,(0===e||n.substring(o-s)===r.substring(0,s))&&(a=s,s++)}return a}function ef(e,t){if(!e||!t||e[0]!==t[0])return 0;let n=0,r=Math.min(e.length,t.length),i=r,l=0;for(;n<i;)e.substring(l,i)===t.substring(l,i)?l=n=i:r=i,i=Math.floor((r-n)/2+n);return i}function ep(e,t){if(!e||!t||e[e.length-1]!==t[t.length-1])return 0;let n=0,r=Math.min(e.length,t.length),i=r,l=0;for(;n<i;)e.substring(e.length-i,e.length-l)===t.substring(t.length-i,t.length-l)?l=n=i:r=i,i=Math.floor((r-n)/2+n);return i}function eg(e){let t=e.map(e=>eu(e)),n=!1,r=[],i=0,l=null,o=0,a=0,s=0,c=0,h=0;for(;o<t.length;)t[o][0]===eL?(r[i++]=o,a=c,s=h,c=0,h=0,l=t[o][1]):(t[o][0]===eM?c+=t[o][1].length:h+=t[o][1].length,l&&l.length<=Math.max(a,s)&&l.length<=Math.max(c,h)&&(t.splice(r[i-1],0,[eT,l]),t[r[i-1]+1][0]=eM,i--,o=--i>0?r[i-1]:-1,a=0,s=0,c=0,h=0,l=null,n=!0)),o++;for(n&&(t=e_(t)),t=ex(t),o=1;o<t.length;){if(t[o-1][0]===eT&&t[o][0]===eM){let e=t[o-1][1],n=t[o][1],r=ed(e,n),i=ed(n,e);r>=i?(r>=e.length/2||r>=n.length/2)&&(t.splice(o,0,[eL,n.substring(0,r)]),t[o-1][1]=e.substring(0,e.length-r),t[o+1][1]=n.substring(r),o++):(i>=e.length/2||i>=n.length/2)&&(t.splice(o,0,[eL,e.substring(0,i)]),t[o-1][0]=eM,t[o-1][1]=n.substring(0,n.length-i),t[o+1][0]=eT,t[o+1][1]=e.substring(i),o++),o++}o++}return t}let ey=/[^a-zA-Z0-9]/,em=/\s/,ek=/[\r\n]/,ev=/\n\r?\n$/,eb=/^\r?\n\r?\n/;function ex(e){let t=e.map(e=>eu(e));function n(e,t){if(!e||!t)return 6;let n=e.charAt(e.length-1),r=t.charAt(0),i=n.match(ey),l=r.match(ey),o=i&&n.match(em),a=l&&r.match(em),s=o&&n.match(ek),c=a&&r.match(ek),h=s&&e.match(ev),u=c&&t.match(eb);return h||u?5:s||c?4:i&&!o&&a?3:o||a?2:i||l?1:0}let r=1;for(;r<t.length-1;){if(t[r-1][0]===eL&&t[r+1][0]===eL){let e=t[r-1][1],i=t[r][1],l=t[r+1][1],o=ep(e,i);if(o){let t=i.substring(i.length-o);e=e.substring(0,e.length-o),i=t+i.substring(0,i.length-o),l=t+l}let a=e,s=i,c=l,h=n(e,i)+n(i,l);for(;i.charAt(0)===l.charAt(0);){e+=i.charAt(0),i=i.substring(1)+l.charAt(0),l=l.substring(1);let t=n(e,i)+n(i,l);t>=h&&(h=t,a=e,s=i,c=l)}t[r-1][1]!==a&&(a?t[r-1][1]=a:(t.splice(r-1,1),r--),t[r][1]=s,c?t[r+1][1]=c:(t.splice(r+1,1),r--))}r++}return t}function e_(e){let t,n=e.map(e=>eu(e));n.push([eL,""]);let r=0,i=0,l=0,o="",a="";for(;r<n.length;)switch(n[r][0]){case eM:l++,a+=n[r][1],r++;break;case eT:i++,o+=n[r][1],r++;break;case eL:i+l>1?(0!==i&&0!==l&&(0!==(t=ef(a,o))&&(r-i-l>0&&n[r-i-l-1][0]===eL?n[r-i-l-1][1]+=a.substring(0,t):(n.splice(0,0,[eL,a.substring(0,t)]),r++),a=a.substring(t),o=o.substring(t)),0!==(t=ep(a,o))&&(n[r][1]=a.substring(a.length-t)+n[r][1],a=a.substring(0,a.length-t),o=o.substring(0,o.length-t))),r-=i+l,n.splice(r,i+l),o.length&&(n.splice(r,0,[eT,o]),r++),a.length&&(n.splice(r,0,[eM,a]),r++),r++):0!==r&&n[r-1][0]===eL?(n[r-1][1]+=n[r][1],n.splice(r,1)):r++,l=0,i=0,o="",a="";break;default:throw Error("Unknown diff operation")}""===n[n.length-1][1]&&n.pop();let s=!1;for(r=1;r<n.length-1;)n[r-1][0]===eL&&n[r+1][0]===eL&&(n[r][1].substring(n[r][1].length-n[r-1][1].length)===n[r-1][1]?(n[r][1]=n[r-1][1]+n[r][1].substring(0,n[r][1].length-n[r-1][1].length),n[r+1][1]=n[r-1][1]+n[r+1][1],n.splice(r-1,1),s=!0):n[r][1].substring(0,n[r+1][1].length)===n[r+1][1]&&(n[r-1][1]+=n[r+1][1],n[r][1]=n[r][1].substring(n[r+1][1].length)+n[r+1][1],n.splice(r+1,1),s=!0)),r++;return s&&(n=e_(n)),n}function ew(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e.map(e=>eu(e)),r=!1,i=[],l=0,o=null,a=0,s=!1,c=!1,h=!1,u=!1;for(;a<n.length;)n[a][0]===eL?(n[a][1].length<t&&(h||u)?(i[l++]=a,s=h,c=u,o=n[a][1]):(l=0,o=null),h=!1,u=!1):(n[a][0]===eT?u=!0:h=!0,o&&(s&&c&&h&&u||o.length<t/2&&3===function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e+(t?1:0),0)}(s,c,h,u))&&(n.splice(i[l-1],0,[eT,o]),n[i[l-1]+1][0]=eM,l--,o=null,s&&c?(h=!0,u=!0,l=0):(a=--l>0?i[l-1]:-1,h=!1,u=!1),r=!0)),a++;return r&&(n=e_(n)),n}function eE(e,t,n,r,i){let l=e.substring(0,n),o=t.substring(0,r),a=e.substring(n),s=t.substring(r),c=eC(l,o,{checkLines:!1,deadline:i}),h=eC(a,s,{checkLines:!1,deadline:i});return c.concat(h)}function eN(e,t,n){let r,i,l,o;let a=e.slice(n,n+Math.floor(e.length/4)),s=-1,c="";for(;-1!==(s=t.indexOf(a,s+1));){let a=ef(e.slice(n),t.slice(s)),h=ep(e.slice(0,n),t.slice(0,s));c.length<h+a&&(c=t.slice(s-h,s)+t.slice(s,s+a),r=e.slice(0,n-h),i=e.slice(n+a),l=t.slice(0,s-h),o=t.slice(s+a))}return 2*c.length>=e.length?[r||"",i||"",l||"",o||"",c||""]:null}let eT=-1,eM=1,eL=0;function eA(e,t,n){var r,i;let l;if(null===e||null===t)throw Error("Null input. (diff)");let o=eC(e,t,{checkLines:!0,deadline:(i=(r=n||{}).timeout||1,l=1,void 0!==i&&(l=i<=0?Number.MAX_VALUE:i),Date.now()+1e3*l),...r});return function(e){for(let t=0;t<e.length;t++){let[n,r]=e[t];if(0===r.length)continue;let i=r[0];(function(e){let t=e.charCodeAt(0);return t>=55296&&t<=56319})(r[r.length-1])&&n===eL&&eR(e,t,1),eh(i)&&n===eL&&eR(e,t,-1)}for(let t=0;t<e.length;t++)0===e[t][1].length&&e.splice(t,1)}(o),o}function eC(e,t,n){let r=e,i=t;if(r===i)return r?[[eL,r]]:[];let l=ef(r,i),o=r.substring(0,l);l=ep(r=r.substring(l),i=i.substring(l));let a=r.substring(r.length-l),s=function(e,t,n){let r;if(!e)return[[eM,t]];if(!t)return[[eT,e]];let i=e.length>t.length?e:t,l=e.length>t.length?t:e,o=i.indexOf(l);if(-1!==o)return r=[[eM,i.substring(0,o)],[eL,l],[eM,i.substring(o+l.length)]],e.length>t.length&&(r[0][0]=eT,r[2][0]=eT),r;if(1===l.length)return[[eT,e],[eM,t]];let a=function(e,t){let n,r,i,l,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(a<=0)return null;let s=e.length>t.length?e:t,c=e.length>t.length?t:e;if(s.length<4||2*c.length<s.length)return null;let h=eN(s,c,Math.ceil(s.length/4)),u=eN(s,c,Math.ceil(s.length/2));if(h&&u)n=h[4].length>u[4].length?h:u;else{if(!h&&!u)return null;u?h||(n=u):n=h}if(!n)throw Error("Unable to find a half match.");return e.length>t.length?(r=n[0],i=n[1],l=n[2],o=n[3]):(l=n[0],o=n[1],r=n[2],i=n[3]),[r,i,l,o,n[4]]}(e,t);if(a){let e=a[0],t=a[1],r=a[2],i=a[3],l=a[4],o=eC(e,r,n),s=eC(t,i,n);return o.concat([[eL,l]],s)}return n.checkLines&&e.length>100&&t.length>100?function(e,t,n){let r=e,i=t,l=function(e,t){let n=[],r={};function i(e){let t="",i=0,o=-1,a=n.length;for(;o<e.length-1;){-1===(o=e.indexOf("\n",i))&&(o=e.length-1);let s=e.slice(i,o+1);(r.hasOwnProperty?r.hasOwnProperty(s):void 0!==r[s])?t+=String.fromCharCode(r[s]):(a===l&&(s=e.slice(i),o=e.length),t+=String.fromCharCode(a),r[s]=a,n[a++]=s),i=o+1}return t}n[0]="";let l=4e4,o=i(e);return l=65535,{chars1:o,chars2:i(t),lineArray:n}}(r,i);r=l.chars1,i=l.chars2;let o=l.lineArray,a=eC(r,i,{checkLines:!1,deadline:n.deadline});!function(e,t){for(let n=0;n<e.length;n++){let r=e[n][1],i=[];for(let e=0;e<r.length;e++)i[e]=t[r.charCodeAt(e)];e[n][1]=i.join("")}}(a,o),(a=eg(a)).push([eL,""]);let s=0,c=0,h=0,u="",d="";for(;s<a.length;){switch(a[s][0]){case eM:h++,d+=a[s][1];break;case eT:c++,u+=a[s][1];break;case eL:if(c>=1&&h>=1){a.splice(s-c-h,c+h),s=s-c-h;let e=eC(u,d,{checkLines:!1,deadline:n.deadline});for(let t=e.length-1;t>=0;t--)a.splice(s,0,e[t]);s+=e.length}h=0,c=0,u="",d="";break;default:throw Error("Unknown diff operation.")}s++}return a.pop(),a}(e,t,n):function(e,t,n){let r=e.length,i=t.length,l=Math.ceil((r+i)/2),o=2*l,a=Array(o),s=Array(o);for(let e=0;e<o;e++)a[e]=-1,s[e]=-1;a[l+1]=0,s[l+1]=0;let c=r-i,h=c%2!=0,u=0,d=0,f=0,p=0;for(let g=0;g<l&&!(Date.now()>n);g++){for(let f=-g+u;f<=g-d;f+=2){let p;let y=l+f,m=(p=f===-g||f!==g&&a[y-1]<a[y+1]?a[y+1]:a[y-1]+1)-f;for(;p<r&&m<i&&e.charAt(p)===t.charAt(m);)p++,m++;if(a[y]=p,p>r)d+=2;else if(m>i)u+=2;else if(h){let i=l+c-f;if(i>=0&&i<o&&-1!==s[i]&&p>=r-s[i])return eE(e,t,p,m,n)}}for(let u=-g+f;u<=g-p;u+=2){let d;let y=l+u,m=(d=u===-g||u!==g&&s[y-1]<s[y+1]?s[y+1]:s[y-1]+1)-u;for(;d<r&&m<i&&e.charAt(r-d-1)===t.charAt(i-m-1);)d++,m++;if(s[y]=d,d>r)p+=2;else if(m>i)f+=2;else if(!h){let i=l+c-u;if(i>=0&&i<o&&-1!==a[i]){let o=a[i],s=l+o-i;if(o>=(d=r-d))return eE(e,t,o,s,n)}}}}return[[eT,e],[eM,t]]}(e,t,n.deadline)}(r=r.substring(0,r.length-l),i=i.substring(0,i.length-l),n);return o&&s.unshift([eL,o]),a&&s.push([eL,a]),s=e_(s)}function eS(e,t,n){return 1===n?e+t:t+e}function eP(e,t){return 1===t?[e.substring(0,e.length-1),e[e.length-1]]:[e.substring(1),e[0]]}function eR(e,t,n){var r,i;let l=1===n?-1:1,o=null,a=null,s=t+n;for(;s>=0&&s<e.length&&(null===o||null===a);s+=n){let[r,i]=e[s];if(0!==i.length){if(r===eM){null===o&&(o=s);continue}if(r===eT){null===a&&(a=s);continue}if(r===eL){if(null===o&&null===a){let[r,i]=eP(e[t][1],n);e[t][1]=r,e[s][1]=eS(e[s][1],i,l);return}break}}}if(null!==o&&null!==a&&(r=o,i=a,1===n?e[r][1][e[r][1].length-1]===e[i][1][e[i][1].length-1]:e[r][1][0]===e[i][1][0])){let[r,i]=eP(e[o][1],l),[s]=eP(e[a][1],l);e[o][1]=r,e[a][1]=s,e[t][1]=eS(e[t][1],i,n);return}let[c,h]=eP(e[t][1],n);e[t][1]=c,null===o?(e.splice(s,0,[eM,h]),null!==a&&a>=s&&a++):e[o][1]=eS(e[o][1],h,l),null===a?e.splice(s,0,[eT,h]):e[a][1]=eS(e[a][1],h,l)}let eD={threshold:.5,distance:1e3};function eB(e,t,n){if(null===e||null===t||null===n)throw Error("Null input. (match())");let r=Math.max(0,Math.min(n,e.length));return e===t?0:e.length?e.substring(r,r+t.length)===t?r:function(e,t,n){let r,i,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t.length>32)throw Error("Pattern too long for this browser.");let o={...eD,...l},a=function(e){let t={};for(let n=0;n<e.length;n++)t[e.charAt(n)]=0;for(let n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t}(t);function s(e,r){let i=e/t.length,l=Math.abs(n-r);return o.distance?i+l/o.distance:l?1:i}let c=o.threshold,h=e.indexOf(t,n);-1!==h&&(c=Math.min(s(0,h),c),-1!==(h=e.lastIndexOf(t,n+t.length))&&(c=Math.min(s(0,h),c)));let u=1<<t.length-1;h=-1;let d=t.length+e.length,f=[];for(let l=0;l<t.length;l++){for(r=0,i=d;r<i;)s(l,n+i)<=c?r=i:d=i,i=Math.floor((d-r)/2+r);d=i;let o=Math.max(1,n-i+1),p=Math.min(n+i,e.length)+t.length,g=Array(p+2);g[p+1]=(1<<l)-1;for(let t=p;t>=o;t--){let r=a[e.charAt(t-1)];if(0===l?g[t]=(g[t+1]<<1|1)&r:g[t]=(g[t+1]<<1|1)&r|((f[t+1]|f[t])<<1|1)|f[t+1],g[t]&u){let e=s(l,t-1);if(e<=c){if(c=e,(h=t-1)>n)o=Math.max(1,2*n-h);else break}}}if(s(l+1,n)>c)break;f=g}return h}(e,t,r):-1}function eI(e,t){return{diffs:[],start1:e,start2:t,utf8Start1:e,utf8Start2:t,length1:0,length2:0,utf8Length1:0,utf8Length2:0}}function ej(e){let t=[];for(let n=0;n<e.length;n++)e[n][0]!==eM&&(t[n]=e[n][1]);return t.join("")}function eO(e){let t=[];for(let n=0;n<e.length;n++)e[n][0]!==eT&&(t[n]=e[n][1]);return t.join("")}function eY(e){let t=0;for(let n=0;n<e.length;n++){let r=e.codePointAt(n);if(void 0===r)throw Error("Failed to get codepoint");t+=eW(r)}return t}function eW(e){return e<=127?1:e<=2047?2:e<=65535?3:4}let ez={margin:4};function eJ(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...ez,...e}}function eU(e,t,n){if(0===t.length)return[];let r=[],i=eI(0,0),l=0,o=0,a=0,s=0,c=0,h=e,u=e;for(let e=0;e<t.length;e++){let d=t[e],[f,p]=d,g=p.length,y=eY(p);switch(l||f===eL||(i.start1=o,i.start2=a,i.utf8Start1=s,i.utf8Start2=c),f){case eM:i.diffs[l++]=d,i.length2+=g,i.utf8Length2+=y,u=u.substring(0,a)+p+u.substring(a);break;case eT:i.length1+=g,i.utf8Length1+=y,i.diffs[l++]=d,u=u.substring(0,a)+u.substring(a+g);break;case eL:g<=2*n.margin&&l&&t.length!==e+1?(i.diffs[l++]=d,i.length1+=g,i.length2+=g,i.utf8Length1+=y,i.utf8Length2+=y):g>=2*n.margin&&l&&(eV(i,h,n),r.push(i),i=eI(-1,-1),l=0,h=u,o=a,s=c);break;default:throw Error("Unknown diff type")}f!==eM&&(o+=g,s+=y),f!==eT&&(a+=g,c+=y)}return l&&(eV(i,h,n),r.push(i)),r}function eV(e,t,n){if(0===t.length)return;let r=t.substring(e.start2,e.start2+e.length1),i=0;for(;t.indexOf(r)!==t.lastIndexOf(r)&&r.length<32-n.margin-n.margin;)i+=n.margin,r=t.substring(e.start2-i,e.start2+e.length1+i);i+=n.margin;let l=e.start2-i;l>=1&&eh(t[l])&&l--;let o=t.substring(l,e.start2);o&&e.diffs.unshift([eL,o]);let a=o.length,s=eY(o),c=e.start2+e.length1+i;c<t.length&&eh(t[c])&&c++;let h=t.substring(e.start2+e.length1,c);h&&e.diffs.push([eL,h]);let u=h.length,d=eY(h);e.start1-=a,e.start2-=a,e.utf8Start1-=s,e.utf8Start2-=s,e.length1+=a+u,e.length2+=a+u,e.utf8Length1+=s+d,e.utf8Length2+=s+d}function eF(e,t){let n,r=0,i=0,l=0,o=0;for(n=0;n<e.length&&(e[n][0]!==eM&&(r+=e[n][1].length),e[n][0]!==eT&&(i+=e[n][1].length),!(r>t));n++)l=r,o=i;return e.length!==n&&e[n][0]===eT?o:o+(t-l)}function e$(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof e)throw Error("Patches must be an array - pass the patch to `parsePatch()` first");let r=t;if(0===e.length)return[r,[]];let i=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=0,i=0;function l(e){for(;r<e;){let e=t.codePointAt(i);if(void 0===e)return i;r+=eW(e),e>65535?i+=2:i+=1}if(!n.allowExceedingIndices&&r!==e)throw Error("Failed to determine byte offset");return i}let o=[];for(let t of e)o.push({diffs:t.diffs.map(e=>eu(e)),start1:l(t.start1),start2:l(t.start2),utf8Start1:t.utf8Start1,utf8Start2:t.utf8Start2,length1:t.length1,length2:t.length2,utf8Length1:t.utf8Length1,utf8Length2:t.utf8Length2});return o}(e,r,{allowExceedingIndices:n.allowExceedingIndices}),l=n.margin||4,o=n.deleteThreshold||.4,a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n="";for(let e=1;e<=t;e++)n+=String.fromCharCode(e);for(let n of e)n.start1+=t,n.start2+=t,n.utf8Start1+=t,n.utf8Start2+=t;let r=e[0],i=r.diffs;if(0===i.length||i[0][0]!==eL)i.unshift([eL,n]),r.start1-=t,r.start2-=t,r.utf8Start1-=t,r.utf8Start2-=t,r.length1+=t,r.length2+=t,r.utf8Length1+=t,r.utf8Length2+=t;else if(t>i[0][1].length){let e=i[0][1].length,l=t-e;i[0][1]=n.substring(e)+i[0][1],r.start1-=l,r.start2-=l,r.utf8Start1-=l,r.utf8Start2-=l,r.length1+=l,r.length2+=l,r.utf8Length1+=l,r.utf8Length2+=l}if(0===(i=(r=e[e.length-1]).diffs).length||i[i.length-1][0]!==eL)i.push([eL,n]),r.length1+=t,r.length2+=t,r.utf8Length1+=t,r.utf8Length2+=t;else if(t>i[i.length-1][1].length){let e=t-i[i.length-1][1].length;i[i.length-1][1]+=n.substring(0,e),r.length1+=e,r.length2+=e,r.utf8Length1+=e,r.utf8Length2+=e}return n}(i,l);r=a+r+a,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;for(let n=0;n<e.length;n++){if(e[n].length1<=32)continue;let r=e[n];e.splice(n--,1);let i=r.start1,l=r.start2,o="";for(;0!==r.diffs.length;){let a=eI(i-o.length,l-o.length),s=!0;if(""!==o){let e=eY(o);a.length1=o.length,a.utf8Length1=e,a.length2=o.length,a.utf8Length2=e,a.diffs.push([eL,o])}for(;0!==r.diffs.length&&a.length1<32-t;){let e=r.diffs[0][0],n=r.diffs[0][1],o=eY(n);if(e===eM){a.length2+=n.length,a.utf8Length2+=o,l+=n.length;let e=r.diffs.shift();e&&a.diffs.push(e),s=!1}else e===eT&&1===a.diffs.length&&a.diffs[0][0]===eL&&n.length>64?(a.length1+=n.length,a.utf8Length1+=o,i+=n.length,s=!1,a.diffs.push([e,n]),r.diffs.shift()):(o=eY(n=n.substring(0,32-a.length1-t)),a.length1+=n.length,a.utf8Length1+=o,i+=n.length,e===eL?(a.length2+=n.length,a.utf8Length2+=o,l+=n.length):s=!1,a.diffs.push([e,n]),n===r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(n.length))}o=(o=eO(a.diffs)).substring(o.length-t);let c=ej(r.diffs).substring(0,t),h=eY(c);""!==c&&(a.length1+=c.length,a.length2+=c.length,a.utf8Length1+=h,a.utf8Length2+=h,0!==a.diffs.length&&a.diffs[a.diffs.length-1][0]===eL?a.diffs[a.diffs.length-1][1]+=c:a.diffs.push([eL,c])),s||e.splice(++n,0,a)}}}(i,l);let s=0,c=[];for(let e=0;e<i.length;e++){let t;let n=i[e].start2+s,l=ej(i[e].diffs),a=-1;if(l.length>32?-1!==(t=eB(r,l.substring(0,32),n))&&(-1===(a=eB(r,l.substring(l.length-32),n+l.length-32))||t>=a)&&(t=-1):t=eB(r,l,n),-1===t)c[e]=!1,s-=i[e].length2-i[e].length1;else{let h;if(c[e]=!0,s=t-n,h=-1===a?r.substring(t,t+l.length):r.substring(t,a+32),l===h)r=r.substring(0,t)+eO(i[e].diffs)+r.substring(t+l.length);else{let n=eA(l,h,{checkLines:!1});if(l.length>32&&function(e){let t=0,n=0,r=0;for(let i=0;i<e.length;i++){let l=e[i][0],o=e[i][1];switch(l){case eM:n+=o.length;break;case eT:r+=o.length;break;case eL:t+=Math.max(n,r),n=0,r=0;break;default:throw Error("Unknown diff operation.")}}return t+Math.max(n,r)}(n)/l.length>o)c[e]=!1;else{n=ex(n);let l=0,o=0;for(let a=0;a<i[e].diffs.length;a++){let s=i[e].diffs[a];s[0]!==eL&&(o=eF(n,l)),s[0]===eM?r=r.substring(0,t+o)+s[1]+r.substring(t+o):s[0]===eT&&(r=r.substring(0,t+o)+r.substring(t+eF(n,l+s[1].length))),s[0]!==eT&&(l+=s[1].length)}}}}}return[r=r.substring(a.length,r.length-a.length),c]}function eH(e){let t,n,r;let{utf8Length1:i,utf8Length2:l,utf8Start1:o,utf8Start2:a,diffs:s}=e;t=0===i?"".concat(o,",0"):1===i?"".concat(o+1):"".concat(o+1,",").concat(i),n=0===l?"".concat(a,",0"):1===l?"".concat(a+1):"".concat(a+1,",").concat(l);let c=["@@ -".concat(t," +").concat(n," @@\n")];for(let e=0;e<s.length;e++){switch(s[e][0]){case eM:r="+";break;case eT:r="-";break;case eL:r=" ";break;default:throw Error("Unknown patch operation.")}c[e+1]="".concat(r+encodeURI(s[e][1]),"\n")}return c.join("").replace(/%20/g," ")}let eq=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;function eZ(e){if(!e)return[];let t=[],n=e.split("\n"),r=0;for(;r<n.length;){let e=n[r].match(eq);if(!e)throw Error("Invalid patch string: ".concat(n[r]));let i=eI(eK(e[1]),eK(e[3]));for(t.push(i),""===e[2]?(i.start1--,i.utf8Start1--,i.length1=1,i.utf8Length1=1):"0"===e[2]?(i.length1=0,i.utf8Length1=0):(i.start1--,i.utf8Start1--,i.utf8Length1=eK(e[2]),i.length1=i.utf8Length1),""===e[4]?(i.start2--,i.utf8Start2--,i.length2=1,i.utf8Length2=1):"0"===e[4]?(i.length2=0,i.utf8Length2=0):(i.start2--,i.utf8Start2--,i.utf8Length2=eK(e[4]),i.length2=i.utf8Length2),r++;r<n.length;){let e;let t=n[r],l=t.charAt(0);if("@"===l)break;if(""===l){r++;continue}try{e=decodeURI(t.slice(1))}catch(e){throw Error("Illegal escape in parse: ".concat(t))}let o=eY(e)-e.length;if("-"===l)i.diffs.push([eT,e]),i.length1-=o;else if("+"===l)i.diffs.push([eM,e]),i.length2-=o;else if(" "===l)i.diffs.push([eL,e]),i.length1-=o,i.length2-=o;else throw Error('Invalid patch mode "'.concat(l,'" in: ').concat(e));r++}}return t}function eK(e){return parseInt(e,10)}function eG(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"setIfMissing",path:t,value:e}}function eX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{type:"diffMatchPatch",path:n,value:(function(e,t,n){if("string"==typeof e&&"string"==typeof t){let r=eA(e,t,{checkLines:!0});return r.length>2&&(r=ew(r=eg(r))),eU(e,r,eJ(n))}if(e&&Array.isArray(e)&&void 0===t)return eU(ej(e),e,eJ(n));if("string"==typeof e&&t&&Array.isArray(t))return eU(e,t,eJ(n));throw Error("Unknown call format to make()")})(e,t).map(eH).join("")}}function eQ(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{type:"insert",path:n,position:t,items:e}}function e0(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"set",path:t,value:e}}function e1(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{type:"unset",path:e}}let e2=[],e3="void-child";function e8(e,t){let n=t[e._key];return n&&M()(e,n)?n:(t[e._key]=e,e)}function e6(e,t){let{schemaTypes:n}=t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e&&Array.isArray(e)?e.map(e=>{let{_type:t,_key:i,...l}=e,o=[{_key:e3,_type:"span",text:"",marks:[]}];if(e&&e._type===n.block.name){let a=!1,s=void 0===e.style,c=void 0===e.markDefs,h=e.children.map(e=>{let{_type:t,_key:n,...i}=e;return"span"!==t?(a=!0,e8({_type:t,_key:n,children:o,value:i,__inline:!0},r)):e});return!s&&!c&&!a&&g.W_.isElement(e)?e:(s&&(l.style=n.styles[0].value),c&&(l.markDefs=e2),e8({_type:t,_key:i,...l,children:h},r))}return e8({_type:t,_key:i,children:o,value:l},r)}):[]}function e4(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.map(e=>{let{_key:r,_type:i}=e;if(!r||!i)throw Error("Not a valid block");if(i===t&&"children"in e&&Array.isArray(e.children)&&r){let t=!1,l=e.children.map(e=>{let{_type:r}=e;if("value"in e&&"span"!==r){t=!0;let{value:r,_key:i,_type:l,__inline:o,children:a,...s}=e;return e8({...s,...r,_key:i,_type:l},n)}return e});return t?e8({...e,children:l,_key:r,_type:i},n):e}let l="value"in e&&e.value;return e8({_key:r,_type:i,..."object"==typeof l?l:{}},n)})}function e5(e,t){var n;return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&g.W_.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&g.xv.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!(null==(n=e[0].children[0].marks)?void 0:n.join(""))&&""===e[0].children[0].text}let e9=G("operationToPatches");function e7(e,t,n){let r;let i=[e.path[0]];if(!t)return null;let l=t[i[0]];if(!l)return null;let o=[{_key:l._key}];if(l._type!==n.block.name)return o;let a=e.path.slice(0,2),s=Array.isArray(l.children)&&l.children[a[1]];return s&&(r=["children",{_key:s._key}]),r?[...o,...r]:o}function te(e,t){if(!t)return[];let[n,r]=Array.from(g.ML.nodes(t,{at:[],match:t=>(0,L.Fd)(e.path[0])&&t._key===e.path[0]._key}))[0]||[void 0,void 0];if(!n||!g.W_.isElement(n))return[];if(t.isVoid(n))return[r[0],0];let i=[e.path[2]],l=n.children.findIndex(e=>M()([{_key:e._key}],i));if(l>=0&&n.children[l]){let e=n.children[l];return g.W_.isElement(e)&&t.isVoid(e)?r.concat(l).concat(0):r.concat(l)}return r}function tt(e,t,n){if(!t)return null;let r=null,i=null,l=t.anchor&&e7(t.anchor,e,n);l&&t.anchor&&(r={path:l,offset:t.anchor.offset});let o=t.focus&&e7(t.focus,e,n);return o&&t.focus&&(i={path:o,offset:t.focus.offset}),r&&i?{anchor:r,focus:i}:null}function tn(e,t){if(!e||!t)return null;let n={path:te(e.anchor,t),offset:e.anchor.offset},r={path:te(e.focus,t),offset:e.focus.offset};return n&&r?{anchor:n,focus:r}:null}function tr(e){if(e){let t=e&&window.getSelection();null==t||t.removeAllRanges()}}e9.enabled=!1;let ti=G("API:editable"),tl=new WeakMap;function to(e,t){let n=tl.get(e);tl.set(e,!0),t(),tl.set(e,n)}let ta=new WeakMap;function ts(e,t){let n=ta.get(e);ta.set(e,!1),t(),ta.set(e,n)}let tc="before",th="after";function tu(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e.concat(t),[])}let td=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),tf={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},inc:(e,t)=>e+t,dec:(e,t)=>e-t},tp=Object.keys(tf),tg={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},diffMatchPatch(e,t){let[n]=e$(eZ(t),e,{allowExceedingIndices:!0});return n}},ty=Object.keys(tg),tm=G("applyPatches"),tk=tm.enabled&&!0;function tv(e){return"object"==typeof e&&"_key"in e}function tb(e,t){tk&&(tm("Children ".concat(t,":"),JSON.stringify(e.children,null,2)),tm("Selection ".concat(t,": "),JSON.stringify(e.selection,null,2)))}function tx(e,t){let{block:n,path:r}=function(e,t){let n=-1,r=e.children.find((e,r)=>{let i=tv(t[0])?e._key===t[0]._key:r===t[0];return i&&(n=r),i});return r?{block:r,path:[n]}:{}}(e,t);if(!(g.W_.isElement(n)&&"children"===t[1]))return{block:n,blockPath:r,child:void 0,childPath:void 0};let i=-1,l=n.children.find((e,n)=>{let r=tv(t[2])?e._key===t[2]._key:n===t[2];return r&&(i=n),r});return l?{block:n,child:l,blockPath:r,childPath:null==r?void 0:r.concat(i)}:{block:n,blockPath:r,child:void 0,childPath:void 0}}function t_(e,t){let n=et.get(e)||!1;et.set(e,!0),t(),et.set(e,n)}let tw=G("plugin:withUndoRedo"),tE=tw.enabled&&!1,tN=new WeakMap,tT=new WeakMap,tM=e=>{let t=tN.get(e);return void 0===t||t},tL=e=>(tT.get(e)||tT.set(e,[]),tT.get(e)||[]);function tA(e,t,n,r,i){tE&&(tw("Adjusting '".concat(n.type,"' operation paths for '").concat(t.type,"' patch")),tw("Operation ".concat(JSON.stringify(n))),tw("Patch ".concat(JSON.stringify(t))));let l={...n};if("insert"===t.type&&1===t.path.length){let e=(r||[]).findIndex(e=>M()({_key:e._key},t.path[0]));return tw("Adjusting block path (+".concat(t.items.length,") for '").concat(l.type,"' operation and patch '").concat(t.type,"'")),[tC(l,t.items.length,e)]}if("unset"===t.type&&1===t.path.length){let n=(i||[]).findIndex(e=>M()({_key:e._key},t.path[0]));return"path"in l&&Array.isArray(l.path)&&l.path[0]===n?(tw("Skipping transformation that targeted removed block"),[]):(tE&&(tw("Selection ".concat(JSON.stringify(e.selection))),tw("Adjusting block path (-1) for '".concat(l.type,"' operation and patch '").concat(t.type,"'"))),[tC(l,-1,n)])}if("unset"===t.type&&0===t.path.length)return tw("Adjusting selection for unset everything patch and ".concat(n.type," operation")),[];if("diffMatchPatch"===t.type){let n;let r=("set_selection"===l.type&&e.selection?n=e.children[e.selection.focus.path[0]]:"path"in l&&(n=e.children[l.path[0]]),n);if(!r||!M()({_key:r._key},t.path[0]))return[l];eZ(t.value).forEach(e=>{var t,n,r,i;let o=0,a=e.utf8Start1,{diffs:s}=e;if(s.forEach((e,t)=>{let[n,r]=e;n===eM?(o+=r.length,a+=r.length):n===eT?(o-=r.length,a-=r.length):n!==eL||s.slice(t).every(e=>{let[t]=e;return t===eL})||(a+=r.length)}),"insert_text"===l.type&&a<l.offset&&(l.offset+=o),"remove_text"===l.type&&a<=l.offset-l.text.length&&(l.offset+=o),"set_selection"===l.type){let e=(null==(t=l.properties)?void 0:t.focus)?{...l.properties.focus}:void 0,s=(null==(n=null==l?void 0:l.properties)?void 0:n.anchor)?{...l.properties.anchor}:void 0,c=(null==(r=null==l?void 0:l.newProperties)?void 0:r.focus)?{...l.newProperties.focus}:void 0,h=(null==(i=null==l?void 0:l.newProperties)?void 0:i.anchor)?{...l.newProperties.anchor}:void 0;(e&&s||c&&h)&&([e,s,c,h].forEach(e=>{e&&a<e.offset&&(e.offset+=o)}),e&&s&&(l.properties={focus:e,anchor:s}),c&&h&&(l.newProperties={focus:c,anchor:h}))}})}return[l]}function tC(e,t,n){var r,i,l,o;let a={...e};if(n>=0&&"set_selection"!==a.type&&Array.isArray(a.path)&&a.path[0]>=n+t&&a.path[0]+t>-1){let e=[a.path[0]+t,...a.path.slice(1)];a.path=e}if("set_selection"===a.type){let e=(null==(r=a.properties)?void 0:r.focus)?{...a.properties.focus}:void 0,s=(null==(i=null==a?void 0:a.properties)?void 0:i.anchor)?{...a.properties.anchor}:void 0,c=(null==(l=null==a?void 0:a.newProperties)?void 0:l.focus)?{...a.newProperties.focus}:void 0,h=(null==(o=null==a?void 0:a.newProperties)?void 0:o.anchor)?{...a.newProperties.anchor}:void 0;(e&&s||c&&h)&&([e,s,c,h].forEach(e=>{e&&e.path[0]>=n+t&&e.path[0]+t>-1&&(e.path=[e.path[0]+t,...e.path.slice(1)])}),e&&s&&(a.properties={focus:e,anchor:s}),c&&h&&(a.newProperties={focus:c,anchor:h}))}return a}let tS=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&g.y$.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&g.y$.equals(e.path,t.path)),tP=(e,t)=>!!t&&"set_selection"===e.type&&"set_selection"===t.type,tR=e=>"set_selection"!==e.type;function tD(e,t){let n=tM(e);tN.set(e,!1),t(),tN.set(e,n)}let tB=G("plugin:withPatches"),tI=G("plugin:withPlaceholderBlock"),tj=G("plugin:withPortableTextBlockStyle"),tO=G("plugin:withPortableTextLists"),tY=G("plugin:withPortableTextMarkModel"),tW=G("plugin:withPortableTextSelections"),tz=tW.enabled&&!1,tJ=G("plugin:withSchemaTypes"),tU=G("plugin:withUtils"),tV=G("plugin:withHotKeys"),tF={marks:{"mod+b":"strong","mod+i":"em","mod+u":"underline","mod+'":"code"},custom:{}};function t$(e,t,n){let r=null,i=!0,l=[t.span.name,...t.inlineObjects.map(e=>e.name)],o=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,a)=>{if(!C()(e))return r={patches:[e1([a])],description:"Block must be an object, got ".concat(String(e)),action:"Unset invalid item",item:e},!0;if(!e._key)return r={patches:[e0({...e,_key:n()},[a])],description:"Block at index ".concat(a," is missing required _key."),action:"Set the block with a random _key value",item:e},!0;if(!e._type||!o.includes(e._type)){if("block"===e._type){let n=t.block.name;return r={patches:[e0({...e,_type:n},[{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid type name '").concat(e._type,"'. According to the schema, the block type name is '").concat(n,"'"),action:"Use type '".concat(n,"'"),item:e},!0}return r={patches:[e1([{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid _type '").concat(e._type,"'"),action:"Remove the block",item:e},!0}if(e._type===t.block.name){if(!e.children)return r={patches:[e1([{_key:e._key}])],description:"Text block with _key '".concat(e._key,"' is missing required key 'children'."),action:"Remove the block",item:e},!0;if(!e.markDefs)return r={patches:[e0({...e,markDefs:[]},[{_key:e._key}])],description:"Block is missing required key 'markDefs'.",action:"Add empty markDefs array",item:e},!0;let o=W()(N()(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[]))).filter(e=>!t.decorators.map(e=>e.value).includes(e)).filter(t=>!!e.markDefs&&!e.markDefs.find(e=>e._key===t));if(o.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>o.includes(e)));if(n)return r={patches:n.map(t=>e0((t.marks||[]).filter(e=>!o.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:"Block with _key '".concat(e._key,"' contains marks (").concat(o.join(", "),") not supported by the current content model."),action:"Remove invalid marks",item:e},!0}if(e.children&&0===e.children.length)return r={patches:[eQ([{_type:t.span.name,_key:n(),text:""}],"after",[{_key:e._key},"children",0])],description:"Children for text block with _key '".concat(e._key,"' is empty."),action:"Insert an empty text",item:e},!0;e.children.some((i,o)=>i._key?i._type&&!1!==l.includes(i._type)?i._type===t.span.name&&void 0===i.text&&(r={patches:[e0({...i,text:""},[{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' is missing text property!"),action:"Write an empty .text to the object",item:e},!0):(r={patches:[e1([{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' has invalid '_type' property (").concat(i._type,")."),action:"Remove the object",item:e},!0):(r={patches:[e0({...i,_key:n()},[{_key:e._key},"children",o])],description:"Child at index ".concat(o," is missing required _key in block with _key ").concat(e._key,"."),action:"Set a new random _key on the object",item:e},!0))&&(i=!1)}return!1})&&(i=!1),{valid:i,resolution:r,value:e}):{valid:!1,resolution:{patches:[e1([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e},value:e}}let tH=G("plugin:withInsertData"),tq={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function tZ(e,t,n){if(!e.selection)return;let[r,i]=g.ML.node(e,e.selection,{depth:1});if(e.isTextBlock(r)&&e.isTextBlock(t[0])){let{markDefs:n}=r;tH("Mixing markDefs of focusBlock and fragments[0] block",n,t[0].markDefs),M()(n,t[0].markDefs)||g.YR.setNodes(e,{markDefs:W()([...t[0].markDefs||[],...n||[]])},{at:i,mode:"lowest",voids:!1})}e5(e.children,n)?(g.YR.splitNodes(e,{at:[0,0]}),e.insertFragment(t),g.YR.removeNodes(e,{at:[0]})):e.insertFragment(t),e.onChange()}let tK=new WeakMap,tG=(e,t)=>{var n;let r;let{keyGenerator:i,portableTextEditor:l,patches$:o,readOnly:a,maxBlocks:s}=t,{schemaTypes:c,change$:h}=l;e.subscriptions=[],e.destroy?e.destroy():tK.set(e,{apply:e.apply,onChange:e.onChange,normalizeNode:e.normalizeNode});let u=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,r){let i=r[n.path[0]],l=e.isTextBlock(i);if(1===n.path.length){let e=0===n.path[0]?"before":"after",l=r[n.path[0]-1],o=0===n.path[0]?null==i?void 0:i._key:null==l?void 0:l._key;return o?[eQ([e4([n.node],t)[0]],e,[{_key:o}])]:[eG(r,[]),eQ([e4([n.node],t)[0]],"before",[n.path[0]])]}if(l&&2===n.path.length&&e.children[n.path[0]]){let e=0!==i.children.length&&i.children[n.path[1]-1]?"after":"before",r={...n.node};return!r._type&&g.xv.isText(r)&&(r._type="span",r.marks=[]),[eQ([e4([{_key:"bogus",_type:t,children:[r]}],t)[0].children[0]],e,[{_key:i._key},"children",i.children.length<=1||!i.children[n.path[1]-1]?0:{_key:i.children[n.path[1]-1]._key}])]}return e9("Something was inserted into a void block. Not producing editor patches."),[]},insertTextPatch:function(e,t,n){e9.enabled&&e9("Operation",JSON.stringify(t,null,2));let r=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&e.isTextSpan(r.children[t.path[1]])&&r.children[t.path[1]];if(!i)throw Error("Could not find child");let l=[{_key:r._key},"children",{_key:i._key},"text"],o=n[t.path[0]],a=e.isTextBlock(o)&&o.children[t.path[1]],s=eX(e.isTextSpan(a)?a.text:"",i.text,l);return s.value.length?[s]:[]},mergeNodePatch:function(e,n,r){let i=[],l=r[n.path[0]],o=e.children[n.path[0]];if(1===n.path.length){if(null==l?void 0:l._key){let r=e4([e.children[n.path[0]-1]],t)[0];i.push(e0(r,[{_key:r._key}])),i.push(e1([{_key:l._key}]))}else throw Error("Target key not found!")}else if(2===n.path.length&&e.isTextBlock(o)){let t=e.isTextBlock(l)&&l.children[n.path[1]]||void 0,r=o.children[n.path[1]-1];e.isTextSpan(r)&&(i.push(e0(r.text,[{_key:l._key},"children",{_key:r._key},"text"])),t&&i.push(e1([{_key:l._key},"children",{_key:t._key}])))}else e9("Void nodes can't be merged, not creating any patches");return i},moveNodePatch:function(e,n,r){let i=[],l=r[n.path[0]],o=r[n.newPath[0]];if(1===n.path.length){let e=n.path[0]>n.newPath[0]?"before":"after";i.push(e1([{_key:l._key}])),i.push(eQ([e4([l],t)[0]],e,[{_key:o._key}]))}else if(2===n.path.length&&e.isTextBlock(l)&&e.isTextBlock(o)){let e=l.children[n.path[1]],r=o.children[n.newPath[1]],a=n.newPath[1]===o.children.length?"after":"before",s=e4([l],t)[0].children[n.path[1]];i.push(e1([{_key:l._key},"children",{_key:e._key}])),i.push(eQ([s],a,[{_key:o._key},"children",{_key:r._key}]))}return i},removeNodePatch:function(e,t,n){let r=n[t.path[0]];if(1===t.path.length){if(r&&r._key)return[e1([{_key:r._key}])];throw Error("Block not found")}if(!e.isTextBlock(r)||2!==t.path.length)return e9("Not creating patch inside object block"),[];{let n=e.isTextBlock(r)&&r.children&&r.children[t.path[1]];return n?[e1([{_key:r._key},"children",{_key:n._key}])]:(e9("Span not found in editor trying to remove node"),[])}},removeTextPatch:function(e,t,n){let r=e&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&r.children[t.path[1]]||void 0,l=e.isTextSpan(i)?i:void 0;if(i&&!l)throw Error("Expected span");if(!l)throw Error("Could not find child");let o=[{_key:r._key},"children",{_key:l._key},"text"],a=n[t.path[0]],s=e.isTextBlock(a)&&a.children[t.path[1]],c=eX(e.isTextSpan(s)&&s.text||"",l.text,o);return c.value?[c]:[]},setNodePatch:function(e,n){if(1===n.path.length){let r=e.children[n.path[0]];if("string"!=typeof r._key)throw Error("Expected block to have a _key");return[e0(e4([v()({...e.children[n.path[0]],...n.newProperties},x())],t)[0],[{_key:r._key}])]}if(2===n.path.length){let t=e.children[n.path[0]];if(e.isTextBlock(t)){let e=t.children[n.path[1]];if(e){let r=t._key,i=e._key,l=[];return Object.keys(n.newProperties).forEach(e=>{let t=w()(n.newProperties,e);l.push(e0(t,[{_key:r},"children",{_key:i},e]))}),l}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)))},splitNodePatch:function(e,n,r){let i=[],l=e.children[n.path[0]];if(!e.isTextBlock(l))throw Error("Block with path ".concat(JSON.stringify(n.path[0])," is not a text block and can't be split"));if(1===n.path.length){let o=r[n.path[0]];if(e.isTextBlock(o)){let r=e4([e.children[n.path[0]+1]],t)[0];r&&(i.push(eQ([r],"after",[{_key:l._key}])),o.children.slice(n.position).forEach(e=>{let t=[{_key:o._key},"children",{_key:e._key}];i.push(e1(t))}))}return i}if(2===n.path.length){let r=l.children[n.path[1]];if(e.isTextSpan(r)){let e=e4([{...l,children:l.children.slice(n.path[1]+1,n.path[1]+2)}],t)[0].children;i.push(eQ(e,"after",[{_key:l._key},"children",{_key:r._key}])),i.push(e0(r.text,[{_key:l._key},"children",{_key:r._key},"text"]))}}return i}}}(c),d=function(e){tl.set(e,!1);let{apply:t,normalizeNode:n}=e;return e.apply=n=>{if("split_node"===n.type&&(n.properties={...n.properties,_key:i()}),"insert_node"===n.type){let t=!tl.get(e)||!("_key"in n.node);g.ML.isEditor(n.node)||(n.node={...n.node,...t?{_key:i()}:{}})}t(n)},e.normalizeNode=t=>{let[r,l]=t;if(g.W_.isElement(r)&&r._type===c.block.name){for(let[t,n]of(r._key||g.YR.setNodes(e,{_key:i()},{at:l}),g.NB.children(e,l)))if(!t._key){g.YR.setNodes(e,{_key:i()},{at:n});return}}n(t)},e},f=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){e.isTextBlock=e=>(0,L.DG)(e)&&e._type===t.block.name,e.isTextSpan=e=>(0,L.NG)(e)&&e._type==t.span.name,e.isListBlock=e=>(0,L.KA)(e)&&e._type===t.block.name,e.isVoid=e=>t.block.name!==e._type&&(t.blockObjects.map(e=>e.name).includes(e._type)||t.inlineObjects.map(e=>e.name).includes(e._type)),e.isInline=e=>t.inlineObjects.map(e=>e.name).includes(e._type)&&"__inline"in e&&!0===e.__inline;let{normalizeNode:r}=e;return e.normalizeNode=i=>{let[l,o]=i;if(void 0===l._type&&2===o.length){tJ("Setting span type on text node without a type");let r=l._key||n();g.YR.setNodes(e,{...l,_type:t.span.name,_key:r},{at:o})}r(i)},e}}({schemaTypes:c,keyGenerator:i}),y=function(e){return l.setEditable({focus:()=>{p.F3.focus(e)},blur:()=>{p.F3.blur(e)},toggleMark:t=>{e.pteToggleMark(t)},toggleList:t=>{e.pteToggleListItem(t)},toggleBlockStyle:t=>{e.pteToggleBlockStyle(t)},isMarkActive:t=>{try{return e.pteIsMarkActive(t)}catch(e){return console.warn(e),!1}},marks:()=>({...g.ML.marks(e)||{}}).marks||[],undo:()=>e.undo(),redo:()=>e.redo(),select:t=>{let n=tn(t,e);n?g.YR.select(e,n):g.YR.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection){let t=g.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t)return e4([t],c.block.name,es.get(e))[0]}},focusChild:()=>{if(e.selection){let t=g.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t&&e.isTextBlock(t))return e4([t],c.block.name,es.get(e))[0].children[e.selection.focus.path[1]]}},insertChild:(t,n)=>{var r;if(!e.selection)throw Error("The editor has no selection");let[o]=Array.from(g.ML.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===c.block.name}))[0]||[void 0];if(!o)throw Error("No focused text block");if(t.name!==c.span.name&&!c.inlineObjects.some(e=>e.name===t.name))throw Error("This type cannot be inserted as a child to a text block");let a=e6([{_key:i(),_type:c.block.name,children:[{_key:i(),_type:t.name,...n||{}}]}],l)[0].children[0],s=e.selection.focus.path.slice(0,2),h=a._type===c.span.name,u=g.NB.get(e,s);return h&&u._type!==c.span.name&&(ti("Inserting span child next to inline object child, moving selection + 1"),e.move({distance:1,unit:"character"})),g.YR.insertNodes(e,a,{select:!0,at:e.selection}),e.onChange(),(null==(r=tt(e4(e.children,c.block.name,es.get(e)),e.selection,c))?void 0:r.focus.path)||[]},insertBlock:(t,n)=>{var r;if(!e.selection)throw Error("The editor has no selection");let o=e6([{_key:i(),_type:t.name,...n||{}}],l)[0];return g.ML.insertNode(e,o),e.onChange(),(null==(r=tt(e4(e.children,c.block.name,es.get(e)),e.selection,c))?void 0:r.focus.path)||[]},hasBlockStyle:t=>{try{return e.pteHasBlockStyle(t)}catch(e){return!1}},hasListStyle:t=>{try{return e.pteHasListStyle(t)}catch(e){return!1}},isVoid:e=>![c.block.name,c.span.name].includes(e._type),findByPath:t=>{let n=tn({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(n){let[r,i]=g.ML.node(e,n.focus.path.slice(0,1));if(r&&i&&"string"==typeof r._key){if(1===t.length&&1===n.focus.path.length)return[e4([r],c.block.name)[0],[{_key:r._key}]];let i=e4([r],c.block.name,es.get(e))[0];if(e.isTextBlock(i)){let e=i.children[n.focus.path[1]];if(e)return[e,[{_key:r._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[r]=Array.from(g.ML.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=p.F3.toDOMNode(e,r)}catch(e){}return n},activeAnnotations:()=>{var t;if(!e.selection||e.selection.focus.path.length<2)return[];try{let n=[];for(let[r,i]of g.ML.nodes(e,{at:e.selection,match:e=>g.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})){let[l]=g.ML.node(e,i,{depth:1});e.isTextBlock(l)&&(null==(t=l.markDefs)||t.forEach(e=>{g.xv.isText(r)&&r.marks&&Array.isArray(r.marks)&&r.marks.includes(e._key)&&n.push(e)}))}return n}catch(e){return[]}},addAnnotation:(t,n)=>{let{selection:r}=e;if(r){let[l]=g.ML.node(e,r.focus,{depth:1});if(g.W_.isElement(l)&&l._type===c.block.name){let o=i();if(e.isTextBlock(l)){g.YR.setNodes(e,{markDefs:[...l.markDefs||[],{_type:t.name,_key:o,...n}]},{at:r.focus}),e.onChange(),g.e6.isCollapsed(r)&&(e.pteExpandToWord(),e.onChange());let[a]=g.ML.node(e,r.focus,{depth:2});if(e.selection){g.ML.withoutNormalizing(e,()=>{g.YR.setNodes(e,{},{match:g.xv.isText,split:!0}),e.selection&&g.xv.isText(a)&&(g.YR.setNodes(e,{marks:[...a.marks||[],o]},{at:e.selection,match:e=>e._type===c.span.name}),e.onChange())}),g.ML.normalize(e),e.onChange();let t=tt(e4(e.children,c.block.name,es.get(e)),e.selection,c);if(t&&"string"==typeof l._key)return g.ML.withoutNormalizing(e,()=>{e.selection&&(g.YR.insertNodes(e,[{_type:"span",text:"",marks:[],_key:i()}],{at:g.e6.end(e.selection)}),e.onChange())}),{spanPath:t.focus.path,markDefPath:[{_key:l._key},"markDefs",{_key:o}]}}}}}},delete:(t,n)=>{if(t){let r=tn(t,e);if(!(r&&r.anchor.path.length>0&&r.focus.path.length>0))throw Error("Invalid range");if(r){if(!(null==n?void 0:n.mode)||(null==n?void 0:n.mode)==="selected"){ti("Deleting content in selection"),g.YR.delete(e,{at:r,hanging:!0,voids:!0}),e.onChange();return}(null==n?void 0:n.mode)==="blocks"&&(ti("Deleting blocks touched by selection"),g.YR.removeNodes(e,{at:r,voids:!0,match:t=>e.isTextBlock(t)||!e.isTextBlock(t)&&g.W_.isElement(t)})),(null==n?void 0:n.mode)==="children"&&(ti("Deleting children touched by selection"),g.YR.removeNodes(e,{at:r,voids:!0,match:t=>t._type===c.span.name||!e.isTextBlock(t)&&g.W_.isElement(t)})),0===e.children.length&&(e.children=[e.createPlaceholderBlock()]),e.onChange()}}},removeAnnotation:t=>{let{selection:n}=e;if(ti("Removing annotation",t),n){if(g.e6.isCollapsed(n)){let[t,r]=g.ML.node(e,n,{depth:2});g.xv.isText(t)&&t.marks&&"string"==typeof t.text&&(g.YR.select(e,r),n=e.selection)}g.ML.withoutNormalizing(e,()=>{n&&g.e6.isExpanded(n)&&(n=e.selection)&&(g.YR.setNodes(e,{},{match:g.xv.isText,split:!0}),e.onChange(),[...g.ML.nodes(e,{at:n,match:e=>g.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})].forEach(n=>{var r;let[i,l]=n,[o]=g.ML.node(e,l,{depth:1});e.isTextBlock(o)&&(null==(r=o.markDefs)||r.filter(e=>e._type===t.name).forEach(t=>{if(g.xv.isText(i)&&Array.isArray(i.marks)&&i.marks.includes(t._key)){let n=[...(i.marks||[]).filter(e=>e!==t._key)];g.YR.setNodes(e,{marks:n},{at:l,voids:!1,split:!1})}}))}))}),g.ML.normalize(e),e.onChange()}},getSelection:()=>{let t=null;if(e.selection){let n=ec.get(e.selection);if(n)return n;t=tt(e4(e.children,c.block.name,es.get(e)),e.selection,c),ec.set(e.selection,t)}return t},getValue:()=>e4(e.children,c.block.name,es.get(e)),isCollapsedSelection:()=>!!e.selection&&g.e6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&g.e6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()}}),e},k=function(e){let t,n,{change$:r,patches$:i,patchFunctions:l,readOnly:o,schemaTypes:a}=e,s=function(e,t){let n=!1;tk&&(tm("\n\nNEW PATCH ============================================================="),tm(JSON.stringify(t,null,2)));try{switch(t.type){case"insert":n=function(e,t,n){let{block:r,child:i,blockPath:l,childPath:o}=tx(e,t.path);if(!r||!l)return tm("Block not found"),!1;if(t.path.length>1&&"children"!==t.path[1])return tm("Ignoring patch targeting void value"),!1;if(1===t.path.length){let{items:r,position:i}=t,o=e6(r,{schemaTypes:n},ea.get(e)),a=l[0],s="after"===i?a+1:a;return tm("Inserting blocks at path [".concat(s,"]")),tb(e,"before"),g.YR.insertNodes(e,o,{at:[s]}),tb(e,"after"),!0}let{items:a,position:s}=t;if(!i||!o)return tm("Child not found"),!1;let c=r&&e6([{...r,children:a}],{schemaTypes:n},ea.get(e)),h=o[1],u=[o[0],"after"===s?h+1:h];return tm("Inserting children at path ".concat(u)),tb(e,"before"),c&&g.W_.isElement(c[0])&&g.YR.insertNodes(e,c[0].children,{at:u}),tb(e,"after"),!0}(e,t,a);break;case"unset":n=function(e,t,n){if(0===t.path.length){tm("Removing everything"),tb(e,"before");let t=e.selection;return g.YR.deselect(e),e.children.forEach((t,n)=>{g.YR.removeNodes(e,{at:[n]})}),g.YR.insertNodes(e,e.createPlaceholderBlock()),t&&g.YR.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),tb(e,"after"),!0}let{block:r,blockPath:i,child:l,childPath:o}=tx(e,t.path);if(1===t.path.length){if(!r||!i)return tm("Block not found"),!1;let t=i[0];return tm("Removing block at path [".concat(t,"]")),tb(e,"before"),g.YR.removeNodes(e,{at:[t]}),tb(e,"after"),!0}if(e.isTextBlock(r)&&"children"===t.path[1]&&3===t.path.length){if(!l||!o)return tm("Child not found"),!1;let t=o[1];return tm("Unsetting child at path ".concat(JSON.stringify(o))),tb(e,"before"),tk&&tm("Removing child at path ".concat(JSON.stringify([o,t]))),g.YR.removeNodes(e,{at:o}),tb(e,"after"),!0}return!1}(e,t,0);break;case"set":n=function(e,t){let n=t.value;"string"==typeof t.path[3]&&((n={})[t.path[3]]=t.value);let{block:r,blockPath:i,child:l,childPath:o}=tx(e,t.path);if(!r)return tm("Block not found"),!1;let a=e.isTextBlock(r);if(a&&t.path.length>1&&"children"!==t.path[1])return tm("Ignoring setting void value"),!1;if(tb(e,"before"),a&&l&&o){if(g.xv.isText(n)&&g.xv.isText(l)){let t=l.text;n.text!==t&&(tm("Setting text property"),e.apply({type:"remove_text",path:o,offset:0,text:t}),e.apply({type:"insert_text",path:o,offset:0,text:n.text}),e.onChange())}else tm("Setting non-text property"),e.apply({type:"set_node",path:o,properties:{},newProperties:n});return!0}if(g.W_.isElement(r)&&1===t.path.length&&i){tm("Setting block property");let{children:t,...l}=n,{children:o,...a}=r||{children:void 0};e.apply({type:"set_node",path:i,properties:{...a},newProperties:l}),r.children.forEach((t,n)=>{e.apply({type:"remove_node",path:i.concat(n),node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:i.concat(n),node:t})})}else if(r&&"value"in r){var s;let n=(s=[r.value],[t].reduce(function e(t,n){return Array.isArray(t)?function(t,n){let r=t.slice();if(0===n.path.length){if("setIfMissing"===n.type){if(!Array.isArray(n.value))throw Error("Cannot set value of an array to a non-array");return void 0===t?n.value:t}if("set"===n.type){if(!Array.isArray(n.value))throw Error("Cannot set value of an array to a non-array");return n.value}if("unset"===n.type)return;if("move"===n.type){if(!n.value||!td(n.value,"from")||!td(n.value,"to"))throw Error('Invalid value of \'move\' patch. Expected a value with "from" and "to" indexes, instead got: '.concat(JSON.stringify(n.value)));return function(e,t,n){let r=e.slice(),i=r[t];return r.splice(t,1),r.splice(n,0,i),r}(r,n.value.from,n.value.to)}throw Error("Invalid array operation: ".concat(n.type))}let[i,...l]=n.path,o=function(e,t){if("number"==typeof t)return t;let n=D()(e,t);return -1!==n&&n}(t,i);if(!1===o)return r;if(0===l.length){if("insert"===n.type){let{position:e,items:r}=n;return function(e,t,n){if(t!==tc&&t!==th)throw Error('Invalid position "'.concat(t,'", must be either ').concat(tc," or ").concat(th));for(var r=arguments.length,i=Array(r>3?r-3:0),l=3;l<r;l++)i[l-3]=arguments[l];let o=tu(...i);if(0===e.length)return o;let a=e.length,s=Math.abs((a+n)%a)%a,c=e.slice();return c.splice("after"===t?s+1:s,0,...tu(o)),c}(t,e,o,r)}if("unset"===n.type){if("number"!=typeof o)throw Error('Expected array index to be a number, instead got "'.concat(o,'"'));return r.splice(o,1),r}}return r[o]=e(r[o],{...n,path:l}),r}(t,n):P()(t)?function(e,t){if(!ty.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for string. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on string values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));let n=tg[t.type];if(n)return n(e,t.value);throw Error("Unknown patch type")}(t,n):C()(t)?function(t,n){let r=O()(t);if(0===n.path.length){if("set"===n.type){if(!C()(n.value))throw Error("Cannot set value of an object to a non-object");return n.value}if("unset"===n.type)return;if("setIfMissing"===n.type)return void 0===t?n.value:t;throw Error("Invalid object operation: ".concat(n.type))}let[i,...l]=n.path;if("string"!=typeof i)throw Error("Expected field name to be a string, instad got: ".concat(i));return 0===l.length&&"unset"===n.type?I()(r,i):(r[i]=e(r[i],{...n,path:l}),r)}(t,n):function(e,t){if(!tp.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for primitives. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on primitive values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.map(e=>JSON.stringify(e)).join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));return tf[t.type](e,t.value)}(t,n)},s))[0];return g.YR.setNodes(e,{...r,value:n},{at:i}),!0}return tb(e,"after"),!0}(e,t);break;case"diffMatchPatch":n=function(e,t){let{block:n,child:r,childPath:i}=tx(e,t.path);if(!n)return tm("Block not found"),!1;if(!r||!i)return tm("Child not found"),!1;if(!(n&&e.isTextBlock(n)&&4===t.path.length&&"children"===t.path[1]&&"text"===t.path[3])||!g.xv.isText(r))return!1;let[l]=e$(eZ(t.value),r.text,{allowExceedingIndices:!0}),o=ew(eA(r.text,l),5);tb(e,"before");let a=0;for(let[t,n]of o)t===eM?(e.apply({type:"insert_text",path:i,offset:a,text:n}),a+=n.length):t===eT?e.apply({type:"remove_text",path:i,offset:a,text:n}):t===eL&&(a+=n.length);return tb(e,"after"),!0}(e,t);break;default:tm("Unhandled patch",t.type)}}catch(e){console.error(e)}return n};return function(e){et.set(e,!1),ta.set(e,!0),n=[...e.children];let{apply:t}=e,c=[],h=()=>{if(0===c.length)return;let t=c;c=[];let n=!1;t_(e,()=>{g.ML.withoutNormalizing(e,()=>{ts(e,()=>{tD(e,()=>{to(e,()=>{t.forEach(t=>{("insert"===t.type||"unset"===t.type)&&tr(!!e.selection),tB.enabled&&tB("Handling remote patch ".concat(JSON.stringify(t))),n=s(e,t)})})})})}),n&&(e.normalize(),e.onChange())})},u=e=>{let{patches:t}=e,n=t.filter(e=>"local"!==e.origin);0!==n.length&&(c=c.concat(n),h())};return i&&e.subscriptions.push(()=>{tB("Subscribing to patches$");let e=i.subscribe(u);return()=>{tB("Unsubscribing to patches$"),e.unsubscribe()}}),e.apply=i=>{if(o)return t(i),e;let s=[],c=e5(n=e.children,a);t(i);let h=e5(e.children,a);if(!ta.get(e))return e;switch(c&&!h&&"set_selection"!==i.type&&s.push(eQ(n,"before",[0])),i.type){case"insert_text":s=[...s,...l.insertTextPatch(e,i,n)];break;case"remove_text":s=[...s,...l.removeTextPatch(e,i,n)];break;case"remove_node":s=[...s,...l.removeNodePatch(e,i,n)];break;case"split_node":s=[...s,...l.splitNodePatch(e,i,n)];break;case"insert_node":s=[...s,...l.insertNodePatch(e,i,n)];break;case"set_node":s=[...s,...l.setNodePatch(e,i,n)];break;case"merge_node":s=[...s,...l.mergeNodePatch(e,i,n)];break;case"move_node":s=[...s,...l.moveNodePatch(e,i,n)]}return!c&&h&&["merge_node","set_node","remove_text","remove_node"].includes(i.type)&&(s=[...s,e1([])],r.next({type:"unset",previousValue:e4(n,a.block.name,es.get(e))})),c&&s.length>0&&(s=[eG([],[]),...s]),s.length>0&&s.forEach(e=>{r.next({type:"patch",patch:{...e,origin:"local"}})}),e},e}}({change$:h,keyGenerator:i,patches$:o,patchFunctions:u,readOnly:a,schemaTypes:c}),b=(n=s||-1,function(e){let{apply:t}=e;return e.apply=r=>{n>0&&e.children.length>=n&&("insert_node"===r.type||"split_node"===r.type)&&1===r.path.length||t(r)},e}),_=function(e){return e.pteToggleListItem=t=>{e.pteHasListStyle(t)?(tO("Remove list item '".concat(t,"'")),e.pteUnsetListItem(t)):(tO("Add list item '".concat(t,"'")),e.pteSetListItem(t))},e.pteUnsetListItem=t=>{e.selection&&[...g.ML.nodes(e,{at:e.selection,match:e=>g.W_.isElement(e)&&e._type===c.block.name})].forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let{listItem:n,level:l,...o}=r,a={...o,listItem:void 0,level:void 0};tO("Unsetting list '".concat(t,"'")),g.YR.setNodes(e,a,{at:i})}})},e.pteSetListItem=t=>{e.selection&&[...g.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})].forEach(n=>{let[r,i]=n;tO("Setting list '".concat(t,"'")),g.YR.setNodes(e,{...r,level:1,listItem:t||c.lists[0]&&c.lists[0].value},{at:i})})},e.pteEndList=()=>{if(!e.selection)return!1;let t=[...g.ML.nodes(e,{at:e.selection,match:t=>g.W_.isElement(t)&&e.isListBlock(t)&&1===t.children.length&&g.xv.isText(t.children[0])&&""===t.children[0].text})];return 0!==t.length&&(t.forEach(t=>{let[n,r]=t;g.W_.isElement(n)&&(tO("Unset list"),g.YR.setNodes(e,{...n,level:void 0,listItem:void 0},{at:r}))}),!0)},e.pteIncrementBlockLevels=t=>{if(!e.selection)return!1;let n=[...g.ML.nodes(e,{at:e.selection,match:t=>!!e.isListBlock(t)})];return 0!==n.length&&(n.forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let n=r.level||1;t?tO("Decrementing list level",Math.min(10,Math.max(1,--n))):tO("Incrementing list level",Math.min(10,Math.max(1,++n))),g.YR.setNodes(e,{level:Math.min(10,Math.max(1,n))},{at:i})}}),!0)},e.pteHasListStyle=t=>!!e.selection&&[...g.ML.nodes(e,{at:e.selection,match:n=>e.isListBlock(n)&&n.listItem===t})].length>0,e},E=function(e){let{readOnly:t,patches$:n,blockSchemaType:r}=e;return e=>{let i=e4(e.children,r.name),l=tL(e);n&&e.subscriptions.push(()=>{tw("Subscribing to patches");let t=n.subscribe(t=>{let{patches:n,snapshot:r}=t,o=!1;n.forEach(t=>{if(!o&&"local"!==t.origin&&l){if("unset"===t.type&&0===t.path.length){tw("Someone else cleared the content, resetting undo/redo history"),e.history={undos:[],redos:[]},l.splice(0,l.length),tN.set(e,!0),o=!0;return}l.push({patch:t,time:new Date,snapshot:r,previousSnapshot:i})}}),i=r});return()=>{tw("Unsubscribing to patches"),t.unsubscribe()}}),e.history={undos:[],redos:[]};let{apply:o}=e;return e.apply=n=>{if(t){o(n);return}let{operations:r,history:i}=e,{undos:l}=i,a=l[l.length-1],s=a&&a.operations&&a.operations[a.operations.length-1],c=tP(n,s),h=tM(e),u=!0;if(h){if(a?0===r.length&&(u=tS(n,s)||c):u=!1,a&&u)a.operations.push(n);else{let t={operations:[...null===e.selection?[]:[{type:"set_selection",properties:{...e.selection},newProperties:{...e.selection}}],n],timestamp:new Date};l.push(t),tw("Created new undo step",a)}for(;l.length>1e3;)l.shift();tR(n)&&(i.redos=[])}o(n)},e.undo=()=>{if(t)return;let{undos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(tw("Undoing",t),t.operations.length>0){let n=l.filter(e=>e.time>=t.timestamp),r=t.operations;n.forEach(t=>{r=N()(r.map(n=>tA(e,t.patch,n,t.snapshot,t.previousSnapshot)))}),tr(!!e.selection);try{g.ML.withoutNormalizing(e,()=>{tD(e,()=>{r.map(g.OX.inverse).reverse().forEach(t=>{e.apply(t)})})}),e.normalize(),e.onChange()}catch(t){tw("Could not perform undo step",t),l.splice(0,l.length),g.YR.deselect(e),e.history={undos:[],redos:[]},tN.set(e,!0),e.onChange();return}e.history.redos.push(t),e.history.undos.pop()}}},e.redo=()=>{if(t)return;let{redos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(tw("Redoing",t),t.operations.length>0){let n=l.filter(e=>e.time>=t.timestamp),r=t.operations;n.forEach(t=>{r=N()(r.map(n=>tA(e,t.patch,n,t.snapshot,t.previousSnapshot)))}),tr(!!e.selection);try{g.ML.withoutNormalizing(e,()=>{tD(e,()=>{r.forEach(t=>{e.apply(t)})})}),e.normalize(),e.onChange()}catch(t){tw("Could not perform redo step",t),l.splice(0,l.length),g.YR.deselect(e),e.history={undos:[],redos:[]},tN.set(e,!0),e.onChange();return}e.history.undos.push(t),e.history.redos.pop()}}},e}}({readOnly:a,patches$:o,blockSchemaType:c.block}),T=function(e){let{apply:t,normalizeNode:n}=e,r=c.decorators.map(e=>e.value),i=()=>{e.selection&&(g.YR.select(e,{...e.selection}),e.selection={...e.selection});let t=tt(e.children,e.selection,c);h.next({type:"selection",selection:t})};return e.normalizeNode=t=>{n(t),e.operations.some(e=>["insert_node","insert_text","merge_node","remove_node","remove_text","set_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t)for(let[n,r]of Array.from(g.ML.nodes(e,{at:g.ML.range(e,[t.anchor.path[0]],[t.focus.path[0]])})).reverse()){let[t]=r.length>1?g.ML.node(e,g.y$.parent(r)):[void 0],i=[r[0],r[1]+1];if(e.isTextBlock(t)){let r=t.children[i[1]];g.xv.isText(n)&&g.xv.isText(r)&&M()(r.marks,n.marks)&&(tY("Merging spans"),g.YR.mergeNodes(e,{at:i,voids:!0}),e.onChange())}}}(e);let[r,i]=t,l=g.xv.isText(r)&&r._type===c.span.name,o=e.isTextBlock(r);if(l||o){for(let t of(l&&!Array.isArray(r.marks)&&(tY("Adding .marks to span node"),g.YR.setNodes(e,{marks:[]},{at:i}),e.onChange()),e.operations)){if("merge_node"===t.type&&1===t.path.length&&"markDefs"in t.properties&&t.properties._type===c.block.name&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0&&t.path[0]-1>=0){let[n,r]=g.ML.node(e,[t.path[0]-1]);if(tY("Copying markDefs over to merged block",t),e.isTextBlock(n)){let i=Array.isArray(n.markDefs)&&n.markDefs||[],l=W()([...i,...t.properties.markDefs]);M()(l,n.markDefs)||(g.YR.setNodes(e,{markDefs:l},{at:r,voids:!1}),e.onChange())}}if("split_node"===t.type&&1===t.path.length&&g.W_.isElementProps(t.properties)&&t.properties._type===c.block.name&&"markDefs"in t.properties&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0&&t.path[0]+1<e.children.length){let[n,r]=g.ML.node(e,[t.path[0]+1]);if(tY("Copying markDefs over to split block",t),e.isTextBlock(n)){let i=Array.isArray(n.markDefs)&&n.markDefs||[];g.YR.setNodes(e,{markDefs:W()([...i,...t.properties.markDefs])},{at:r,voids:!1}),e.onChange()}}if("split_node"===t.type&&2===t.path.length&&t.properties._type===c.span.name&&"marks"in t.properties&&Array.isArray(t.properties.marks)&&t.properties.marks.length>0&&t.path[0]+1<e.children.length){let[n,r]=g.ML.node(e,[t.path[0]+1,0]);g.xv.isText(n)&&""===n.text&&Array.isArray(n.marks)&&n.marks.length>0&&(g.YR.setNodes(e,{marks:[]},{at:r,voids:!1}),e.onChange())}if("split_node"===t.type&&1===t.path.length&&t.properties._type===c.block.name&&"markDefs"in t.properties&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0){let[n,r]=g.ML.node(e,[t.path[0]]);e.isTextBlock(n)&&1===n.children.length&&n.markDefs&&n.markDefs.length>0&&g.xv.isText(n.children[0])&&""===n.children[0].text&&(!n.children[0].marks||0===n.children[0].marks.length)&&(g.YR.setNodes(e,{markDefs:[]},{at:r}),e.onChange())}}l&&Array.isArray(r.marks)&&(!r.marks||r.marks.length>0&&""===r.text)&&(g.YR.setNodes(e,{marks:[]},{at:i,voids:!1}),e.onChange())}o&&e.operations.some(e=>["split_node","remove_node","remove_text","merge_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t){for(let[n,r]of g.ML.nodes(e,{at:t,match:e=>e._type===c.block.name}))if(e.isTextBlock(n)){let t=(n.markDefs||[]).filter(e=>n.children.find(t=>g.xv.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));M()(t,n.markDefs)||(tY("Removing markDef not in use"),g.YR.setNodes(e,{markDefs:t},{at:r}),e.onChange())}}}(e)},e.apply=n=>{var i,l;if("insert_text"===n.type){let{selection:o}=e;if(o&&g.e6.isCollapsed(o)&&(null==(l=null==(i=g.ML.marks(e))?void 0:i.marks)?void 0:l.some(e=>!r.includes(e)))){let[i]=Array.from(g.ML.nodes(e,{mode:"lowest",at:o.focus,match:e=>e._type===c.span.name,voids:!1}))[0]||[void 0];if(g.xv.isText(i)&&i.text.length===o.focus.offset&&Array.isArray(i.marks)&&i.marks.length>0){t(n),g.YR.splitNodes(e,{match:g.xv.isText,at:{...o.focus,offset:o.focus.offset}});let i=(({...g.ML.marks(e)||{}}).marks||[]).filter(e=>r.includes(e));g.YR.setNodes(e,{marks:i},{at:g.y$.next(o.focus.path)}),tY("Inserting text at end of annotation");return}}}t(n)},e.addMark=t=>{if(e.selection){if(g.e6.isExpanded(e.selection)){g.YR.setNodes(e,{},{match:g.xv.isText,split:!0});let n=[...g.ML.nodes(e,{at:e.selection,match:g.xv.isText})];if(N()(n.map(e=>e[0]).map(e=>e.marks)).includes(t))return e.removeMark(t),e;g.ML.withoutNormalizing(e,()=>{n.forEach(n=>{let[r,i]=n,l=[...(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t),t];g.YR.setNodes(e,{marks:l},{at:i,match:g.xv.isText,split:!0,hanging:!0})})}),g.ML.normalize(e)}else{let n={...g.ML.marks(e)||{}}.marks||[],r={...g.ML.marks(e)||{},marks:[...n,t]};return e.marks=r,i(),e}e.onChange(),i()}return e},e.removeMark=t=>{let{selection:n}=e;if(n){if(g.e6.isExpanded(n))g.ML.withoutNormalizing(e,()=>{g.YR.setNodes(e,{},{match:g.xv.isText,split:!0}),e.selection&&[...g.ML.nodes(e,{at:e.selection,match:g.xv.isText})].forEach(n=>{let[r,i]=n,l=e.children[i[0]];g.W_.isElement(l)&&l.children.includes(r)&&g.YR.setNodes(e,{marks:(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t),_type:"span"},{at:i})})}),g.ML.normalize(e);else{let n={...g.ML.marks(e)||{}}.marks||[],r={...g.ML.marks(e)||{},marks:n.filter(e=>e!==t)};return e.marks={marks:r.marks,_type:"span"},i(),e}e.onChange(),i()}return e},e.pteIsMarkActive=t=>{if(!e.selection)return!1;let n={...g.ML.marks(e)||{}}.marks||[];return g.e6.isExpanded(e.selection)&&Array.from(g.ML.nodes(e,{match:g.xv.isText,at:e.selection})).forEach(e=>{let[t]=e;n=W()([...n,...t.marks||[]])}),n.includes(t)},e.pteToggleMark=t=>{e.pteIsMarkActive(t)?(tY("Remove mark '".concat(t,"'")),g.ML.removeMark(e,t)):(tY("Add mark '".concat(t,"'")),g.ML.addMark(e,t,!0))},e},A=function(e){let t=e.styles[0].value;return function(e){let{normalizeNode:n}=e;return e.normalizeNode=r=>{n(r);let[,i]=r;for(let n of e.operations)if("split_node"===n.type&&1===n.path.length&&e.isTextBlock(n.properties)&&n.properties.style!==t&&n.path[0]===i[0]&&!g.y$.equals(i,n.path)){let[r]=g.ML.node(e,[n.path[0]+1,0]);if(g.xv.isText(r)&&""===r.text){tj("Normalizing split node to ".concat(t," style"),n),g.YR.setNodes(e,{style:t},{at:[n.path[0]+1],voids:!1});break}}},e.pteHasBlockStyle=t=>!!e.selection&&[...g.ML.nodes(e,{at:e.selection,match:n=>e.isTextBlock(n)&&n.style===t})].length>0,e.pteToggleBlockStyle=n=>{e.selection&&([...g.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})].forEach(r=>{let[i,l]=r;e.isTextBlock(i)&&i.style===n?(tj("Unsetting block style '".concat(n,"'")),g.YR.setNodes(e,{...i,style:t},{at:l})):(n?tj("Setting style '".concat(n,"'")):tj("Setting default style",t),g.YR.setNodes(e,{...i,style:n||t},{at:l}))}),e.onChange())},e}}(c),S=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){return e.createPlaceholderBlock=()=>(tI("Creating placeholder block"),{_type:t.block.name,_key:n(),style:t.styles[0].value||"normal",markDefs:[],children:[{_type:"span",_key:n(),text:"",marks:[]}]}),e}}({keyGenerator:i,schemaTypes:c}),R=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){return e.pteExpandToWord=()=>{let{selection:t}=e;if(t&&!g.e6.isExpanded(t)){let[n]=g.ML.node(e,t.focus,{depth:2});if(!n||!g.xv.isText(n)||0===n.text.length){tU("pteExpandToWord: Can't expand to word here");return}let{focus:r}=t,i=r.offset,l=n.text.slice(0,i),o=n.text.slice(i,-1),a=e=>e.match(/\s/g),s=l.split("").reverse().findIndex(e=>a(e)),c=s>-1?l.length-s:0,h=o.split("").findIndex(e=>a(e)),u=l.length+(h>-1?h:o.length+1);if(!(c===u||isNaN(c)||isNaN(u))){tU("pteExpandToWord: Expanding to focused word"),g.YR.setSelection(e,{anchor:{...t.anchor,offset:c},focus:{...t.focus,offset:u}});return}tU("pteExpandToWord: Can't expand to word here")}},e}}({keyGenerator:i,schemaTypes:c}),B=(r=null,function(e){let t=()=>{if(r!==e.selection){let t=null;if(e.selection){let n=ec.get(e.selection);n?t=n:(t=tt(e.children,e.selection,c),ec.set(e.selection,t))}tz&&tW("Emitting selection ".concat(JSON.stringify(t||null)," (").concat(JSON.stringify(e.selection),")")),t?h.next({type:"selection",selection:t}):h.next({type:"selection",selection:null})}r=e.selection},{onChange:n}=e;return e.onChange=()=>{let r=e.operations.length>0;n(),r&&t()},e});return(e.destroy=()=>{let t=tK.get(e);if(!t)throw Error("Could not find pristine versions of editor functions");e.apply=t.apply,e.history={undos:[],redos:[]},e.normalizeNode=t.normalizeNode,e.onChange=t.onChange},a)?{editor:f(d(T(A(R(S(_(B(y(e))))))))),subscribe:()=>m()}:{editor:f(d(T(A(_(S(R(b(E(k(B(y(e)))))))))))),subscribe:()=>{let t=[];return e.subscriptions.forEach(e=>{t.push(e())}),()=>{t.forEach(e=>{e()})}}}},tX=G("component:PortableTextEditor:SlateContainer");function tQ(e){let{patches$:t,portableTextEditor:n,readOnly:r,maxBlocks:i,keyGenerator:l}=e,[o,c]=(0,s.useMemo)(()=>{tX("Creating new Slate editor instance");let{editor:e,subscribe:o}=tG((0,p.BU)((0,g.Jh)()),{keyGenerator:l,maxBlocks:i,patches$:t,portableTextEditor:n,readOnly:r});return es.set(e,{}),ea.set(e,{}),[e,o]},[]);(0,s.useEffect)(()=>{let e=c();return()=>{e()}},[c]),(0,s.useEffect)(()=>{tX("Re-initializing plugin chain"),tG(o,{keyGenerator:l,maxBlocks:i,patches$:t,portableTextEditor:n,readOnly:r})},[l,n,i,r,t,o]);let h=(0,s.useMemo)(()=>[o.createPlaceholderBlock()],[o]);return(0,s.useEffect)(()=>()=>{tX("Destroying Slate editor"),o.destroy()},[o]),(0,a.jsx)(p.mH,{editor:o,initialValue:h,children:e.children})}let t0=(0,s.createContext)(null),t1=()=>{let e=(0,s.useContext)(t0);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},t2=(0,s.createContext)(null),t3=()=>{let e=(0,s.useContext)(t2);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e},t8=(0,s.createContext)(void 0),t6=(0,s.createContext)(!1),t4=()=>{let e=(0,s.useContext)(t6);if(void 0===e)throw Error("The `usePortableTextEditorReadOnly` hook must be used inside the <PortableTextEditor> component's context.");return e},t5=G("hook:useSyncValue"),t9=new WeakMap,t7=G("component:PortableTextEditor:Synchronizer"),ne=t7.enabled&&!1;function nt(e){let{change$:t,portableTextEditor:n,onChange:r,keyGenerator:i,readOnly:l,value:o}=e,[c,h]=(0,s.useState)(null),u=(0,s.useRef)([]),d=function(e){let{portableTextEditor:t,readOnly:n,keyGenerator:r}=e,{change$:i,schemaTypes:l}=t,o=(0,s.useRef)(),a=(0,p.ui)(),c=(0,s.useRef)(),h=(0,s.useCallback)(()=>{let e=t9.get(t);if(o.current===e){t5("Value is the same object as previous, not need to sync");return}c.current&&e&&(t5("Updating the value debounced"),c.current(e))},[t]),u=(0,s.useCallback)($()(h,1e3,{trailing:!0,leading:!1}),[h]);return(0,s.useMemo)(()=>{let e=e=>{t9.set(t,e);let s=en.get(a),c=et.get(a);if(!n){if(s){t5("Has local changes, not syncing value right now"),u();return}if(c){t5("Has remote changes, not syncing value right now"),u();return}}let h=!1,d=!0,f=!!a.selection;if(e&&0!==e.length||(t5("Value is empty"),g.ML.withoutNormalizing(a,()=>{tD(a,()=>{ts(a,()=>{f&&g.YR.deselect(a);let e=a.children.length;a.children.forEach((t,n)=>{g.YR.removeNodes(a,{at:[e-1-n]})}),g.YR.insertNodes(a,a.createPlaceholderBlock(),{at:[0]}),f&&g.YR.select(a,[0,0])})})}),h=!0),e&&e.length>0){let t=e6(e,{schemaTypes:l});g.ML.withoutNormalizing(a,()=>{t_(a,()=>{tD(a,()=>{ts(a,()=>{let n=a.children.length;if(t.length<n){for(let e=n-1;e>t.length-1;e--)g.YR.removeNodes(a,{at:[e]});h=!0}t.forEach((t,n)=>{let o=a.children[n];if(o&&!M()(t,o)&&d){let s=t$([e[n]],l,r);s.valid?(o._key===t._key?(t5.enabled&&t5("Updating block",o,t),function(e,t,n,r){if(g.YR.setNodes(e,t,{at:[r]}),e.isTextBlock(t)&&e.isTextBlock(n)){let i=n.children.length;t.children.length<i&&Array.from(Array(i-t.children.length)).forEach((t,n)=>{let l=i-1-n;l>0&&(t5("Removing child"),g.YR.removeNodes(e,{at:[r,l]}))}),t.children.forEach((t,i)=>{let l=n.children[i],o=!M()(t,l),a=!M()(t.text,null==l?void 0:l.text),s=[r,i];if(o){if(t._key===(null==l?void 0:l._key)){t5("Updating changed child",t,l),g.YR.setNodes(e,t,{at:s});let n=g.xv.isText(t)&&"span"===t._type&&g.xv.isText(l)&&"span"===l._type;n&&a?(g.YR.delete(e,{at:{focus:{path:s,offset:0},anchor:{path:s,offset:l.text.length}}}),g.YR.insertText(e,t.text,{at:s}),e.onChange()):n||(t5("Updating changed inline object child",t),g.YR.setNodes(e,{_key:e3},{at:[...s,0],voids:!0}))}else l?(t5("Replacing child",t),g.YR.removeNodes(e,{at:[r,i]}),to(e,()=>{g.YR.insertNodes(e,t,{at:[r,i]})}),e.onChange()):l||(t5("Inserting new child",t),to(e,()=>{g.YR.insertNodes(e,t,{at:[r,i]}),e.onChange()}))}})}}(a,t,o,n)):(t5.enabled&&t5("Replacing block",o,t),function(e,t,n){let r=e.selection,i=r&&r.focus.path[0]===n;i&&g.YR.deselect(e),g.YR.removeNodes(e,{at:[n]}),to(e,()=>{g.YR.insertNodes(e,t,{at:[n]})}),i&&g.YR.select(e,r)}(a,t,n)),h=!0):(i.next({type:"invalidValue",resolution:s.resolution,value:e}),d=!1)}if(!o&&d){let o=t$([e[n]],l,r);t5.enabled&&t5("Validating and inserting new block in the end of the value",t),o.valid?to(a,()=>{g.YR.insertNodes(a,t,{at:[n]})}):(t5("Invalid",o),i.next({type:"invalidValue",resolution:o.resolution,value:e}),d=!1)}})})})})})}if(!d){t5("Invalid value, returning");return}if(h){t5("Server value changed, syncing editor");try{a.onChange()}catch(t){console.error(t),i.next({type:"invalidValue",resolution:null,value:e});return}f&&!a.selection&&(g.YR.select(a,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),a.onChange()),i.next({type:"value",value:e})}else t5("Server value and editor value is equal, no need to sync.");o.current=e};return c.current=e,e},[i,r,t,n,l,a,u])}({keyGenerator:i,onChange:r,portableTextEditor:n,readOnly:l}),f=(0,p.ui)();(0,s.useEffect)(()=>{en.set(f,!1)},[f]);let y=(0,s.useCallback)(()=>{if(u.current.length>0){t7("Flushing pending patches"),ne&&t7("Patches:\n".concat(JSON.stringify(u.current,null,2)));let e=nr.getValue(n);t.next({type:"mutation",patches:u.current,snapshot:e}),u.current=[]}en.set(f,!1)},[f,n,t]),m=(0,s.useMemo)(()=>V()(()=>{if(g.ML.isNormalizing(f)){y();return}m()},1e3,{leading:!1,trailing:!0}),[y,f]);(0,s.useEffect)(()=>()=>{y()},[y]),(0,s.useEffect)(()=>{t7("Subscribing to editor changes$");let e=t.subscribe(e=>{switch(e.type){case"patch":en.set(f,!0),u.current.push(e.patch),m(),r(e);break;case"selection":(0,s.startTransition)(()=>{ne&&t7("Setting selection"),h(e.selection)}),r(e);break;default:r(e)}});return()=>{t7("Unsubscribing to changes$"),e.unsubscribe()}},[t,r,m,f]);let k=(0,s.useCallback)(()=>{t7("Editor is online, syncing from props.value"),t.next({type:"connection",value:"online"}),d(o)},[t,d,o]),v=(0,s.useCallback)(()=>{t7("Editor is offline"),t.next({type:"connection",value:"offline"})},[t]);(0,s.useEffect)(()=>(n.props.patches$&&(window.addEventListener("online",k),window.addEventListener("offline",v)),()=>{n.props.patches$&&(window.removeEventListener("online",k),window.removeEventListener("offline",v))}));let b=(0,s.useRef)(!0);return(0,s.useEffect)(()=>{t7("Value from props changed, syncing new value"),d(o),b.current&&(t.next({type:"loading",isLoading:!1}),t.next({type:"ready"}),b.current=!1)},[t,d,o]),(0,a.jsx)(Q.Provider,{value:i,children:(0,a.jsx)(t2.Provider,{value:n,children:(0,a.jsx)(t8.Provider,{value:o,children:(0,a.jsx)(t6.Provider,{value:l,children:(0,a.jsx)(t0.Provider,{value:c,children:e.children})})})})})}let nn=G("component:PortableTextEditor");class nr extends s.Component{constructor(e){if(super(e),this.change$=new c.x,this.setEditable=e=>{this.editable={...this.editable,...e}},!e.schemaType)throw Error('PortableTextEditor: missing "type" property');e.incomingPatches$&&console.warn("The prop 'incomingPatches$' is deprecated and renamed to 'patches$'"),this.change$.next({type:"loading",isLoading:!0}),this.schemaTypes=Z(e.schemaType.hasOwnProperty("jsonType")?e.schemaType:q(e.schemaType))}componentDidUpdate(e){this.props.schemaType!==e.schemaType&&(this.schemaTypes=Z(this.props.schemaType.hasOwnProperty("jsonType")?this.props.schemaType:q(this.props.schemaType)))}render(){let{onChange:e,value:t,children:n,patches$:r,incomingPatches$:i}=this.props,{change$:l}=this,o=void 0===this.props.maxBlocks?void 0:parseInt(this.props.maxBlocks.toString(),10)||void 0,s=!!this.props.readOnly,c=this.props.keyGenerator||X;return(0,a.jsx)(tQ,{keyGenerator:c,maxBlocks:o,patches$:i||r,portableTextEditor:this,readOnly:s,children:(0,a.jsx)(nt,{change$:l,keyGenerator:c,onChange:e,portableTextEditor:this,readOnly:s,value:t,children:n})})}}function ni(e,t){if(!e||!t)return null;let n=[],r=e.offset||0,i="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,l="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,o=t.find(e=>e._key===i);if(!o)return null;if(n.push({_key:o._key}),o&&"children"===e.path[1]){if(!o.children||Array.isArray(o.children)&&0===o.children.length)return null;let t=Array.isArray(o.children)&&o.children.find(e=>e._key===l);if(!t)return null;n.push("children"),n.push({_key:t._key}),r=t.text&&t.text.length>=e.offset?e.offset:t.text&&t.text.length||0}return{path:n,offset:r}}function nl(e){let t=(0,s.useCallback)(()=>alert(JSON.stringify(e.annotation)),[e.annotation]);return(0,a.jsx)("span",{style:{color:"blue"},onClick:t,children:e.children})}nr.activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[],nr.addAnnotation=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.addAnnotation(t,n)},nr.blur=e=>{var t;nn("Host blurred"),null==(t=e.editable)||t.blur()},nr.delete=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.delete(t,n)},nr.findDOMNode=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.findDOMNode(t)},nr.findByPath=(e,t)=>{var n;return(null==(n=e.editable)?void 0:n.findByPath(t))||[]},nr.focus=e=>{var t;nn("Host requesting focus"),null==(t=e.editable)||t.focus()},nr.focusBlock=e=>{var t;return null==(t=e.editable)?void 0:t.focusBlock()},nr.focusChild=e=>{var t;return null==(t=e.editable)?void 0:t.focusChild()},nr.getSelection=e=>e.editable?e.editable.getSelection():null,nr.getValue=e=>{var t;return null==(t=e.editable)?void 0:t.getValue()},nr.hasBlockStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasBlockStyle(t)},nr.hasListStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasListStyle(t)},nr.isCollapsedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isCollapsedSelection()},nr.isExpandedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isExpandedSelection()},nr.isMarkActive=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isMarkActive(t)},nr.insertChild=(e,t,n)=>{var r;return nn("Host inserting child"),null==(r=e.editable)?void 0:r.insertChild(t,n)},nr.insertBlock=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.insertBlock(t,n)},nr.insertBreak=e=>{var t;return null==(t=e.editable)?void 0:t.insertBreak()},nr.isVoid=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isVoid(t)},nr.isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1];return t.length>1&&"children"!==t[1]||n},nr.marks=e=>{var t;return null==(t=e.editable)?void 0:t.marks()},nr.select=(e,t)=>{var n;nn("Host setting selection",t),null==(n=e.editable)||n.select(t)},nr.removeAnnotation=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.removeAnnotation(t)},nr.toggleBlockStyle=(e,t)=>{var n;return nn("Host is toggling block style"),null==(n=e.editable)?void 0:n.toggleBlockStyle(t)},nr.toggleList=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.toggleList(t)},nr.toggleMark=(e,t)=>{var n;nn("Host toggling mark",t),null==(n=e.editable)||n.toggleMark(t)};let no=G("components:Leaf"),na=[],ns=e=>{let{attributes:t,children:n,leaf:r,schemaTypes:i,renderChild:l,renderDecorator:o,renderAnnotation:c}=e,h=s.useRef(null),u=t3(),d=(0,p.vt)(),[f,y]=(0,s.useState)(!1),[m,k]=(0,s.useState)(!1),v=n.props.parent,b=(0,s.useMemo)(()=>v?[{_key:null==v?void 0:v._key},"children",{_key:r._key}]:[],[v,r._key]),x=(0,s.useMemo)(()=>i.decorators.map(e=>e.value),[i.decorators]),_=(0,s.useMemo)(()=>W()((r.marks||na).filter(e=>x.includes(e))),[x,r.marks]),w=Array.isArray(r.marks)?r.marks:na,E=(0,s.useMemo)(()=>w.map(e=>{var t;return!x.includes(e)&&(null==(t=null==v?void 0:v.markDefs)?void 0:t.find(t=>t._key===e))}).filter(Boolean),[w,v,x]),N=E.length>0&&d;(0,s.useEffect)(()=>{if(!N){y(!1);return}let e=nr.getSelection(u);e&&M()(e.focus.path,b)&&nr.isCollapsedSelection(u)&&(0,s.startTransition)(()=>{y(!0)})},[N,b,u]);let T=(0,s.useCallback)(()=>{if(!N)return;no("Setting selection and focus from range");let e=window.getSelection();if(!e){k(!1);return}if(e&&e.rangeCount>0){let t=e.getRangeAt(0);h.current&&t.intersectsNode(h.current)?k(!0):k(!1)}else k(!1)},[N]);(0,s.useEffect)(()=>{if(!N)return;let e=u.change$.subscribe(e=>{if("blur"===e.type){y(!1),k(!1);return}if("focus"===e.type){let e=nr.getSelection(u);e&&M()(e.focus.path,b)&&nr.isCollapsedSelection(u)&&y(!0),T();return}"selection"===e.type&&(e.selection&&M()(e.selection.focus.path,b)&&nr.isCollapsedSelection(u)?y(!0):y(!1),T())});return()=>{e.unsubscribe()}},[b,u,T,N]),(0,s.useEffect)(()=>T(),[T]);let L=(0,s.useMemo)(()=>{let e=n;if(g.xv.isText(r)&&r._type===i.span.name&&(_.forEach(t=>{let n=i.decorators.find(e=>e.value===t);n&&o&&(e=o(Object.defineProperty({children:e,editorElementRef:h,focused:f,path:b,selected:m,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)})))}),v&&E.length>0&&E.forEach(t=>{let n=i.annotations.find(e=>e.name===t._type);if(n){if(c){let r=Object.defineProperty({block:v,children:e,editorElementRef:h,focused:f,path:b,selected:m,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)});e=(0,a.jsx)("span",{ref:h,children:c(r)})}else e=(0,a.jsx)(nl,{annotation:t,children:(0,a.jsx)("span",{ref:h,children:e})})}}),v&&l)){let t=v.children.find(e=>e._key===r._key);t&&(e=l(Object.defineProperty({annotations:E,children:(0,a.jsx)(a.Fragment,{children:e}),editorElementRef:h,focused:f,path:b,schemaType:i.span,selected:m,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),i.span)})))}return e},[E,v,n,f,r,_,b,c,l,o,i.annotations,i.decorators,i.span,m]);return(0,s.useMemo)(()=>(0,a.jsx)("span",{...t,ref:h,children:L},r._key),[r,t,L])},nc=e=>(0,a.jsx)("div",{children:(0,a.jsx)("pre",{children:JSON.stringify(e.value,null,2)})});var nh=Object.freeze,nu=Object.defineProperty,nd=(e,t)=>nh(nu(e,"raw",{value:nh(t||e.slice())}));let nf=H.ZP.div(r||(r=nd(["\n  user-select: none;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");H.ZP.span(i||(i=nd(["\n  background: #999;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");let np=H.ZP.div(l||(l=nd(["\n  &.pt-list-item {\n    width: fit-content;\n    position: relative;\n    display: block;\n\n    /* Important 'transform' in order to force refresh the ::before and ::after rules\n      in Webkit: https://stackoverflow.com/a/21947628/831480\n    */\n    transform: translateZ(0);\n    margin-left: ",";\n  }\n  &.pt-list-item > .pt-list-item-inner {\n    display: flex;\n    margin: 0;\n    padding: 0;\n    &:before {\n      justify-content: flex-start;\n      vertical-align: top;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner:before {\n      content: '","';\n      font-size: 0.4375rem; /* 7px */\n      line-height: 1.5rem; /* Same as body text */\n      /* Optical alignment */\n      position: relative;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner {\n    &:before {\n      min-width: 1.5rem; /* Make sure space between bullet and text never shrinks */\n    }\n  }\n  &.pt-list-item-number {\n    counter-increment: ",";\n    counter-reset: ",";\n  }\n  & + :not(.pt-list-item-number) {\n    counter-reset: listItemNumber;\n  }\n  &.pt-list-item-number > .pt-list-item-inner:before {\n    content: ",";\n    min-width: 1.5rem; /* Make sure space between number and text never shrinks */\n    /* Optical alignment */\n    position: relative;\n    top: 1px;\n  }\n"])),e=>(function(e){switch(Number(e)){case 1:return"1.5em";case 2:return"3em";case 3:return"4.5em";case 4:return"6em";case 5:return"7.5em";case 6:return"9em";case 7:return"10.5em";case 8:return"12em";case 9:return"13.5em";case 10:return"15em";default:return"0em"}})(e.listLevel),e=>{var t;return t=e.listLevel,"bullet"===e.listStyle?ny[(t-1)%3]:"*"},e=>(function(e){switch(e){case 1:return"listItemNumber";case 2:return"listItemAlpha";case 3:return"listItemRoman";case 4:return"listItemNumberNext";case 5:return"listItemLetterNext";case 6:return"listItemRomanNext";case 7:return"listItemNumberNextNext";case 8:return"listItemAlphaNextNext";case 9:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"listItemAlpha";case 2:return"listItemRoman";case 3:return"listItemNumberNext";case 4:return"listItemLetterNext";case 5:return"listItemRomanNext";case 6:return"listItemNumberNextNext";case 7:return"listItemAlphaNextNext";case 8:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"counter(listItemNumber) '. '";case 2:return"counter(listItemAlpha, lower-alpha) '. '";case 3:return"counter(listItemRoman, lower-roman) '. '";case 4:return"counter(listItemNumberNext) '. '";case 5:return"counter(listItemLetterNext, lower-alpha) '. '";case 6:return"counter(listItemRomanNext, lower-roman) '. '";case 7:return"counter(listItemNumberNextNext) '. '";case 8:return"counter(listItemAlphaNextNext, lower-alpha) '. '";case 9:return"counter(listItemRomanNextNext, lower-roman) '. '";default:return"counter(listItemNumberNextNextNext) '. '"}})(e.listLevel)),ng=H.ZP.div(o||(o=nd([""]))),ny=["","",""],nm=G("components:DraggableBlock"),nk=e=>{let{children:t,element:n,readOnly:r,blockRef:i}=e,l=(0,p._7)(),o=(0,s.useRef)(),[c,h]=(0,s.useState)(!1),u=(0,s.useMemo)(()=>g.ML.isVoid(l,n),[l,n]),d=(0,s.useMemo)(()=>g.ML.isInline(l,n),[l,n]),[f,y]=(0,s.useState)(null);(0,s.useEffect)(()=>y(i?i.current:p.F3.toDOMNode(l,n)),[l,n,i]);let m=(0,s.useCallback)(e=>{let t=ei.get(l);if(!t||!f)return;e.preventDefault(),e.dataTransfer.dropEffect="move",el.set(l,n);let r=f.getBoundingClientRect(),i=r.top,o=r.height,a=e.pageY,s="bottom";if(n===l.children[0]?s="top":(s=Math.abs(i-a)<o/2?"top":"bottom",eo.set(l,s)),t===n){e.dataTransfer.dropEffect="none";return}h(!0)},[f,l,n]),k=(0,s.useCallback)(()=>{h(!1)},[]),v=(0,s.useCallback)(e=>{let t=el.get(l);if(t){er.set(l,!1),e.preventDefault(),e.stopPropagation(),el.delete(l),o.current&&(nm("Removing drag ghost"),document.body.removeChild(o.current));let r=eo.get(l);eo.delete(l);let i=p.F3.findPath(l,t),a=p.F3.findPath(l,n),s=g.y$.isBefore(a,i);if("bottom"===r&&!s){if(i[0]>=l.children.length-1){nm("target is already at the bottom, not moving");return}let e=i;i=g.y$.next(i),nm("Adjusting targetPath from ".concat(JSON.stringify(e)," to ").concat(JSON.stringify(i)))}if("top"===r&&s&&i[0]!==l.children.length-1){let e=i;i=g.y$.previous(i),nm("Adjusting targetPath from ".concat(JSON.stringify(e)," to ").concat(JSON.stringify(i)))}if(g.y$.equals(i,a)){e.preventDefault(),nm("targetPath and myPath is the same, not moving");return}nm("Moving element ".concat(n._key," from path ").concat(JSON.stringify(a)," to ").concat(JSON.stringify(i)," (").concat(r,")")),g.YR.moveNodes(l,{at:a,to:i}),l.onChange();return}nm("No target element, not doing anything")},[l,n]),b=(0,s.useCallback)(e=>{ei.get(l)&&(nm("On drop (prevented)",n),e.preventDefault(),e.stopPropagation(),h(!1))},[l,n]),x=(0,s.useCallback)(e=>{if(!u){ei.delete(l);return}er.set(l,!0),ei.set(l,n),e.stopPropagation();let t=e.target;t instanceof HTMLElement&&(t.style.opacity="1")},[l,n,u]),_=(0,s.useCallback)(e=>{if(!u||d){nm("Not dragging block"),ei.delete(l),er.set(l,!1);return}if(nm("Drag start"),er.set(l,!0),e.dataTransfer&&(e.dataTransfer.setData("application/portable-text","something"),e.dataTransfer.effectAllowed="move"),f&&f instanceof HTMLElement){let t=f.cloneNode(!0),n=t.querySelector("[data-pt-drag-ghost-element]");if(n&&(t=n),t.setAttribute("data-dragged",""),document.body){o.current=t,t.style.position="absolute",t.style.left="-99999px",t.style.boxSizing="border-box",document.body.appendChild(t);let n=f.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top;t.style.width="".concat(n.width,"px"),t.style.height="".concat(n.height,"px"),e.dataTransfer.setDragImage(t,r,i)}}x(e)},[f,l,x,d,u]),w=c&&l.children[0]===el.get(l),E=c&&l.children[l.children.length-1]===el.get(l),N=eo.get(l),T=w||c&&!w&&!E&&"top"===N,M=E||c&&!w&&!E&&"bottom"===N,L=(0,s.useMemo)(()=>(0,a.jsx)("div",{className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5}}),[]);return r?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsxs)("div",{draggable:u,onDragStart:_,onDrag:x,onDragOver:m,onDragLeave:k,onDragEnd:v,onDrop:b,children:[T&&L,t,M&&L]})};G("components:Element");let nv=[],nb={display:"inline-block"},nx=e=>{let t,n,{attributes:r,children:i,element:l,schemaTypes:o,readOnly:c,renderBlock:h,renderChild:u,renderListItem:d,renderStyle:f,spellCheck:y}=e,m=(0,p._7)(),k=(0,p.vt)(),v=(0,s.useRef)(null),b=(0,s.useRef)(null),x=k&&m.selection&&g.e6.isCollapsed(m.selection)||!1,_=(0,s.useMemo)(()=>e4([l],o.block.name,es.get(m))[0],[m,l,o.block.name]),w=i,E=(0,s.useMemo)(()=>[{_key:l._key}],[l]);if("string"!=typeof l._type)throw Error("Expected element to have a _type property");if("string"!=typeof l._key)throw Error("Expected element to have a _key property");if(m.isInline(l)){let e=p.F3.findPath(m,l),[t]=g.ML.node(m,e,{depth:1}),n=o.inlineObjects.find(e=>e.name===l._type);if(!n)throw Error("Could not find type for inline block element");if(g.W_.isElement(t)){let e=[{_key:t._key},"children",{_key:l._key}];return(0,a.jsxs)("span",{...r,children:[i,(0,a.jsxs)("span",{draggable:!c,className:"pt-inline-object",ref:b,style:nb,contentEditable:!1,children:[u&&u({annotations:nv,children:(0,a.jsx)(nc,{value:_}),editorElementRef:b,focused:x,path:e,schemaType:n,selected:k,type:n,value:_}),!u&&(0,a.jsx)(nc,{value:_})]},l._key)]})}throw Error("Block not found!")}if(l._type===o.block.name){let e;t="pt-block pt-text-block";let n="listItem"in l,s="style"in l&&l.style||"normal";t="pt-block pt-text-block pt-text-block-style-".concat(s);let u=o.styles.find(e=>e.value===s);if(f&&u&&(w=f({block:l,children:i,focused:x,selected:k,value:s,path:E,schemaType:u,editorElementRef:v})),n&&("number"==typeof l.level&&(e=l.level),t+=" pt-list-item pt-list-item-".concat(l.listItem," pt-list-item-level-").concat(e||1)),m.isListBlock(_)&&n&&l.listItem){let e=o.lists.find(e=>e.value===l.listItem);w=d&&e?d({block:_,children:w,focused:x,selected:k,value:l.listItem,path:E,schemaType:e,level:_.level||1,editorElementRef:v}):(0,a.jsx)(np,{listStyle:_.listItem||o.lists[0].value,listLevel:_.level||1,children:(0,a.jsx)(ng,{children:w})})}let p=Object.defineProperty({children:w,editorElementRef:v,focused:x,level:e,listItem:n?l.listItem:void 0,path:E,selected:k,style:s,schemaType:o.block,value:_},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),o.block)}),g=h?h(p):i;return(0,a.jsx)("div",{...r,className:t,spellCheck:y,children:(0,a.jsx)(nk,{element:l,readOnly:c,blockRef:v,children:(0,a.jsx)("div",{ref:v,children:g})})},l._key)}let N=o.blockObjects.find(e=>e.name===l._type);if(!N)throw Error("Could not find schema type for block element of _type ".concat(l._type));t="pt-block pt-object-block";let T=e4([l],o.block.name,es.get(m))[0];return h&&(n=h(Object.defineProperty({children:(0,a.jsx)(nc,{value:_}),editorElementRef:v,focused:x,path:E,schemaType:N,selected:k,value:T},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),N)}))),(0,a.jsxs)("div",{...r,className:t,children:[i,(0,a.jsxs)(nk,{element:l,readOnly:c,blockRef:v,children:[n&&(0,a.jsx)("div",{ref:v,contentEditable:!1,children:n}),!n&&(0,a.jsx)(nf,{selected:k,children:(0,a.jsx)(nc,{value:_})})]})]},l._key)},n_="undefined"==typeof window?s.useEffect:s.useLayoutEffect,nw=G("component:Editable"),nE={opacity:.5,position:"absolute",userSelect:"none",pointerEvents:"none",left:0,right:0},nN=[],nT=(0,s.forwardRef)(function(e,t){let{hotkeys:n,onBlur:r,onFocus:i,onBeforeInput:l,onPaste:o,onCopy:c,renderAnnotation:h,renderBlock:u,renderChild:d,renderDecorator:f,renderListItem:y,renderPlaceholder:k,renderStyle:v,selection:b,scrollSelectionIntoView:x,spellCheck:_,...w}=e,E=t3(),N=t4(),T=ee(),A=function(e){let t=(0,s.useRef)(null);return n_(()=>{e&&("function"==typeof e?e(t.current):e.current=t.current)}),t}(t),[C,S]=(0,s.useState)(null),[P,R]=(0,s.useState)(!1),{change$:D,schemaTypes:B}=E,I=(0,p.ui)(),j=B.block.name,O=(0,s.useMemo)(()=>function(e){let t=B.block.name,n=B.span.name,r=t=>t.map(t=>{var r;return e.isTextBlock(t)?t.children.map(e=>{var t;return e._type===n?e.text:"[".concat((null==(t=B.inlineObjects.find(t=>t.name===e._type))?void 0:t.title)||"Object","]")}).join(""):"[".concat((null==(r=B.blockObjects.find(e=>e.name===t._type))?void 0:r.title)||"Object","]")}).join("\n\n");return e.setFragmentData=(n,i)=>{let{selection:l}=e;if(!l)return;let[o,a]=g.e6.edges(l),s=g.ML.void(e,{at:o.path}),c=g.ML.void(e,{at:a.path});if(g.e6.isCollapsed(l)&&!s)return;let h=p.F3.toDOMRange(e,l),u=h.cloneContents();if(c){let[t]=c,n=h.cloneRange(),r=p.F3.toDOMNode(e,t);n.setEndAfter(r),u=n.cloneContents()}Array.from(u.querySelectorAll("[data-slate-zero-width]")).forEach(e=>{let t="n"===e.getAttribute("data-slate-zero-width");e.textContent=t?"\n":""}),Array.from(u.querySelectorAll("*")).forEach(e=>{for(let t in e.removeAttribute("contentEditable"),e.removeAttribute("data-slate-inline"),e.removeAttribute("data-slate-leaf"),e.removeAttribute("data-slate-node"),e.removeAttribute("data-slate-spacer"),e.removeAttribute("data-slate-string"),e.removeAttribute("data-slate-zero-width"),e.removeAttribute("draggable"),e.attributes)e.hasAttribute(t)&&e.removeAttribute(t)});let d=u.ownerDocument.createElement("div");d.appendChild(u),d.setAttribute("hidden","true"),u.ownerDocument.body.appendChild(d);let f=d.innerHTML;u.ownerDocument.body.removeChild(d);let y=e4(e.getFragment(),t),m=JSON.stringify(y),k=r(y);n.clearData(),n.setData("text/plain",k),n.setData("text/html",f),n.setData("application/json",m),n.setData("application/x-portable-text",m),tH("text",k),n.setData("application/x-portable-text-event-origin",i||"external"),tH("Set fragment data",m,f)},e.insertPortableTextData=t=>{var r;if(!e.selection)return!1;let i=t.getData("application/x-portable-text"),l=t.getData("application/x-portable-text-event-origin");if(tH("Inserting portable text from ".concat(l," event"),i),i){let t=JSON.parse(i);if(Array.isArray(t)&&t.length>0){let i=e6(t,{schemaTypes:B}).map(t=>{let r={...t};e.isTextBlock(r)&&(r.markDefs=(r.markDefs||[]).map(t=>{let i=t._key,l=T();return r.children=r.children.map(t=>t._type===n&&e.isTextSpan(t)?{...t,marks:t.marks&&t.marks.includes(i)?[...t.marks].filter(e=>e!==i).concat(l):t.marks}:t),{...t,_key:l}}));let i={...r,_key:T()};return e.isTextBlock(i)&&(i.children=i.children.map(e=>({...e,_key:T()}))),i}),l=t$(t,B,T);if(!l.valid){let e="".concat(null==(r=l.resolution)?void 0:r.description);return D.next({type:"error",level:"warning",name:"pasteError",description:e,data:l}),tH("Invalid insert result",l),!1}return tZ(e,i,B),!0}}return!1},e.insertTextOrHTMLData=n=>{var r;if(!e.selection)return tH("No selection, not inserting"),!1;D.next({type:"loading",isLoading:!0});let i=n.getData("text/html"),l=n.getData("text/plain");if(i||l){let o,a,s;if(tH("Inserting data",n),i)a=e6(o=(0,J.zW)(i,B.portableText).map(e=>(0,J.nX)(e,{blockTypeName:t})),{schemaTypes:B}),s="HTML";else{let e=String(l).replace(/[&<>"'`=/]/g,e=>tq[e]).split(/\n{2,}/).map(e=>e?"<p>".concat(e.replace(/(?:\r\n|\r|\n)/g,"<br/>"),"</p>"):"<p></p>").join("");a=e6(o=(0,J.zW)("<html><body>".concat(e,"</body></html>"),B.portableText).map(e=>(0,J.nX)(e,{blockTypeName:t})),{schemaTypes:B}),s="text"}let c=t$(o,B,T);if(!c.valid){let e="Could not validate the resulting portable text to insert.\n".concat(null==(r=c.resolution)?void 0:r.description,"\nTry to insert as plain text (shift-paste) instead.");return D.next({type:"error",level:"warning",name:"pasteError",description:e,data:c}),tH("Invalid insert result",c),!1}return tH("Inserting ".concat(s," fragment at ").concat(JSON.stringify(e.selection))),tZ(e,a,B),D.next({type:"loading",isLoading:!1}),!0}return D.next({type:"loading",isLoading:!1}),!1},e.insertData=t=>{e.insertPortableTextData(t)||e.insertTextOrHTMLData(t)},e.insertFragmentData=t=>{let n=t.getData("application/x-portable-text");if(n){let t=JSON.parse(n);return e.insertFragment(t),!0}return!1},e},[D,T,B]),Y=(0,s.useMemo)(()=>(function(e,t,n,r){let i=["enter","tab","shift","delete","end"],l=r||tF,o=()=>e6([{_type:e.block.name,_key:t(),style:"normal",markDefs:[],children:[{_type:"span",_key:t(),text:"",marks:[]}]}],n)[0];return function(t){return t.pteWithHotKeys=r=>{Object.keys(l).forEach(e=>{if("marks"===e)for(let n in l[e]){if(i.includes(n))throw Error("The hotkey ".concat(n," is reserved!"));if((0,z.ZP)(n,r.nativeEvent)){r.preventDefault();let i=l[e];if(i){let e=i[n];tV("HotKey ".concat(n," to toggle ").concat(e)),t.pteToggleMark(e)}}}if("custom"===e)for(let t in l[e]){if(i.includes(t))throw Error("The hotkey ".concat(t," is reserved!"));if((0,z.ZP)(t,r.nativeEvent)){let i=l[e];i&&(0,i[t])(r,n)}}});let a=(0,z.ZP)("enter",r.nativeEvent),s=(0,z.ZP)("tab",r.nativeEvent),c=(0,z.ZP)("shift+enter",r.nativeEvent),h=(0,z.ZP)("shift+tab",r.nativeEvent),u=(0,z.ZP)("backspace",r.nativeEvent),d=(0,z.ZP)("delete",r.nativeEvent);if(u&&t.selection&&t.selection.focus.path[0]>0&&g.e6.isCollapsed(t.selection)){let e=g.y$.previous(t.selection.focus.path.slice(0,1)),n=g.NB.descendant(t,e),i=g.NB.descendant(t,t.selection.focus.path.slice(0,1));if(n&&i&&g.ML.isVoid(t,n)&&0===t.selection.focus.offset){tV("Preventing deleting void block above"),r.preventDefault(),r.stopPropagation(),g.YR.removeNodes(t,{match:e=>e===i}),g.YR.select(t,e),t.onChange();return}}if(d&&t.selection&&0===t.selection.focus.offset&&g.e6.isCollapsed(t.selection)&&t.children[t.selection.focus.path[0]+1]){let e=g.NB.descendant(t,g.y$.next(t.selection.focus.path.slice(0,1))),n=t.selection.focus.path.slice(0,1),i=g.NB.descendant(t,n);if(e&&i&&!g.ML.isVoid(t,i)&&g.ML.isVoid(t,e)){tV("Preventing deleting void block below"),r.preventDefault(),r.stopPropagation(),g.YR.removeNodes(t,{match:e=>e===i}),g.YR.select(t,n),t.onChange();return}}if((s||h)&&t.selection){let[e]=g.ML.node(t,t.selection.focus,{depth:2}),[n]=(0,L.NG)(e)?g.ML.node(t,t.selection.focus,{depth:1}):[],i=e&&(0,L.DG)(n)&&(0,L.NG)(e)&&(e.marks||[]).filter(e=>(n.markDefs||[]).map(e=>e._key).includes(e)).length>0,[l]=g.e6.edges(t.selection),o=g.ML.isStart(t,l,l.path);e&&(0,L.NG)(e)&&(!i||o)&&t.pteIncrementBlockLevels(h)&&r.preventDefault()}if(a&&!c&&t.selection){let n=t.selection.focus.path.slice(0,1),i=g.NB.descendant(t,n);if(t.isListBlock(i)){t.pteEndList()&&r.preventDefault();return}if(t.isTextBlock(i)&&i.style&&i.style!==e.styles[0].value){let[,e]=g.e6.edges(t.selection);if(g.ML.isEnd(t,e,e.path)){g.ML.insertNode(t,o()),r.preventDefault(),t.onChange();return}}if(i&&g.ML.isVoid(t,i)){g.ML.insertNode(t,o()),r.preventDefault(),t.onChange();return}r.preventDefault(),t.insertBreak(),t.onChange()}if(c){r.preventDefault(),t.insertText("\n");return}if((0,z.ZP)("mod+z",r.nativeEvent)){r.preventDefault(),t.undo();return}((0,z.ZP)("mod+y",r.nativeEvent)||(0,z.ZP)("mod+shift+z",r.nativeEvent))&&(r.preventDefault(),t.redo())},t}})(B,T,E,n),[n,T,E,B]);(0,s.useMemo)(()=>N?(nw("Editable is in read only mode"),O(I)):(nw("Editable is in edit mode"),O(Y(I))),[N,I,Y,O]);let W=(0,s.useCallback)(e=>(0,a.jsx)(nx,{...e,readOnly:N,renderBlock:u,renderChild:d,renderListItem:y,renderStyle:v,schemaTypes:B,spellCheck:_}),[B,_,N,u,d,y,v]),U=(0,s.useCallback)(e=>{let t=(0,a.jsx)(ns,{...e,schemaTypes:B,renderAnnotation:h,renderChild:d,renderDecorator:f,readOnly:N});return k&&e.leaf.placeholder&&""===e.text.text?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{style:nE,contentEditable:!1,children:k()}),t]}):t},[N,h,d,f,k,B]),V=(0,s.useCallback)(()=>{if(b){nw("Selection from props ".concat(JSON.stringify(b)));let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,r=null,{anchor:i,focus:l}=e;return(i&&t.find(e=>M()({_key:e._key},i.path[0]))&&(n=ni(i,t)),l&&t.find(e=>M()({_key:e._key},l.path[0]))&&(r=ni(l,t)),n&&r)?{anchor:n,focus:r}:null}(b,e4(I.children,j));if(null!==e){nw("Normalized selection from props ".concat(JSON.stringify(e)));let t=tn(e,I);t&&(g.YR.select(I,t),I.operations.some(e=>"set_selection"===e.type)||D.next({type:"selection",selection:e}),I.onChange())}}},[b,I,j,D]);(0,s.useEffect)(()=>{nw("Subscribing to editor changes$");let e=D.subscribe(e=>{switch(e.type){case"ready":V();break;case"invalidValue":R(!0);break;case"value":R(!1)}});return()=>{nw("Unsubscribing to changes$"),e.unsubscribe()}},[D,V]),(0,s.useEffect)(()=>{b&&!P&&V()},[P,b,V]);let F=(0,s.useCallback)(e=>{c&&void 0!==c(e)&&e.preventDefault()},[c]),$=(0,s.useCallback)(e=>{if(e.preventDefault(),I.selection){if(!o){nw("Pasting normally"),I.insertData(e.clipboardData);return}new Promise(t=>{let n=nr.getValue(E),r=tt(n,I.selection,B);t(o({event:e,value:n,path:(null==r?void 0:r.focus.path)||[],schemaTypes:B}))}).then(t=>{if(nw("Custom paste function from client resolved",t),D.next({type:"loading",isLoading:!0}),!t||!t.insert){nw("No result from custom paste handler, pasting normally"),I.insertData(e.clipboardData);return}if(t&&t.insert){I.insertFragment(e6(t.insert,{schemaTypes:B})),D.next({type:"loading",isLoading:!1});return}console.warn("Your onPaste function returned something unexpected:",t)}).catch(e=>(D.next({type:"loading",isLoading:!1}),console.error(e),e))}},[D,o,E,B,I]),H=(0,s.useCallback)(e=>{if(i&&i(e),!e.isDefaultPrevented()){let t=nr.getSelection(E);null===t&&(g.YR.select(I,g.ML.start(I,[])),I.onChange()),D.next({type:"focus",event:e}),t===nr.getSelection(E)&&D.next({type:"selection",selection:t})}},[i,E,D,I]),q=(0,s.useCallback)(e=>{r&&r(e),e.isPropagationStopped()||D.next({type:"blur",event:e})},[D,r]),Z=(0,s.useCallback)(e=>{l&&l(e)},[l]),K=(0,s.useCallback)(()=>{if(!I.selection)return;let{activeElement:e}=p.F3.findDocumentOrShadowRoot(I);if(A.current!==e)return;let t=p.F3.getWindow(I).getSelection();if(!t)return;let n=t.getRangeAt(0);try{let e=p.F3.toDOMRange(I,I.selection);(e.startOffset!==n.startOffset||e.endOffset!==n.endOffset)&&(nw("DOM range out of sync, validating selection"),null==t||t.removeAllRanges(),t.addRange(e))}catch(e){nw("Could not resolve selection, selecting top document"),g.YR.deselect(I),I.children.length>0&&g.YR.select(I,[0,0]),I.onChange()}},[A,I]);(0,s.useEffect)(()=>{if(C){let e=new MutationObserver(K);return e.observe(C,{attributeOldValue:!1,attributes:!1,characterData:!1,childList:!0,subtree:!0}),()=>{e.disconnect()}}},[K,C]);let G=(0,s.useCallback)(t=>{e.onKeyDown&&e.onKeyDown(t),t.isDefaultPrevented()||I.pteWithHotKeys(t)},[e,I]),X=(0,s.useMemo)(()=>void 0===x?void 0:null===x?m():(e,t)=>{x(E,t)},[E,x]),Q=(0,s.useCallback)(()=>e5(I.children,B)?[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}]:nN,[B,I]);return((0,s.useEffect)(()=>{A.current=p.F3.toDOMNode(I,I),S(A.current)},[I,A]),E)?P?null:(0,a.jsx)(p.CX,{...w,autoFocus:!1,className:w.className||"pt-editable",decorate:Q,onBlur:q,onCopy:F,onDOMBeforeInput:Z,onFocus:H,onKeyDown:G,onPaste:$,readOnly:N,renderPlaceholder:void 0,renderElement:W,renderLeaf:U,scrollSelectionIntoView:X}):null})}}]);